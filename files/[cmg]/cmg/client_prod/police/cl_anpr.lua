local a=true;local b=false;local c=""local d=""local e;local f;local g={}local h=false;local i=false;TriggerEvent('chat:addSuggestion','/flagf','Flags the front vehicle',{{name="Reason",help="Flag reason"}})TriggerEvent('chat:addSuggestion','/flagr','Flags the rear vehicle',{{name="Reason",help="Flag reason"}})RegisterCommand("flagf",function(j,k)if c~=""then local l=""if table.count(k)~=0 then l=table.concat(k," ")TriggerServerEvent("CMG:flagVehicleAnpr",string.upper(c),l)else tvRP.notify("~r~Error~w~: You must provide a valid flag reason.")end end end,false)RegisterCommand("flagr",function(j,k)if d~=""then local l=""if table.count(k)~=0 then l=table.concat(k," ")TriggerServerEvent("CMG:flagVehicleAnpr",string.upper(d),l)else tvRP.notify("~r~Error~w~: You must provide a valid flag reason.")end end end,false)RegisterCommand("anpr",function(k,m)a=not a end,false)RegisterCommand("lockanpr",function(k,m)b=not b end,false)local n=false;local function o()if IsPedInAnyVehicle(CMG.getPlayerPed(),false)then if GetVehicleClass(CMG.getPlayerVehicle())==18 and globalOnPoliceDuty then return true end end;return false end;local function p(q)local r;if q=="front"then r=50.0 elseif q=="rear"then r=-50.0 end;local s=GetVehiclePedIsIn(CMG.getPlayerPed(),false)local t=GetOffsetFromEntityInWorldCoords(s,0.0,1.0,0.3)local u=GetOffsetFromEntityInWorldCoords(s,0.0,r,0.0)local v=StartExpensiveSynchronousShapeTestLosProbe(t,u,10,s,0)local w,w,w,w,x=GetShapeTestResult(v)if x>0 and IsEntityAVehicle(x)then local y=GetVehicleNumberPlateText(x)if y~=nil then if g[y]~=nil then local z=g[y]if not h then PlaySoundFrontend(-1,"BEEP_GREEN","DLC_HEIST_HACKING_SNAKE_SOUNDS",1)end;tvRP.notify(string.format("~r~ANPR Alert~w~: Plate ~b~%s ~w~is flagged for:~b~~n~%s",y,z))h=true;SetTimeout(10000,function()h=false end)end end;return x else return nil end end;Citizen.CreateThread(function()while true do if a then n=o()if n then e=p("front")if e and not b then c=GetVehicleNumberPlateText(e)or"N/A"local A=GetLabelText(GetDisplayNameFromVehicleModel(GetEntityModel(e)))local B=math.ceil(GetEntitySpeed(e)*2.236936)SendNUIMessage({anprSetFront=true,plate=c,model=A,speed=B})end;f=p("rear")if f and not b then d=GetVehicleNumberPlateText(f)or"N/A"local A=GetLabelText(GetDisplayNameFromVehicleModel(GetEntityModel(f)))local B=math.ceil(GetEntitySpeed(f)*2.236936)SendNUIMessage({anprSetRear=true,plate=d,model=A,speed=B})end end end;Wait(250)end end)local function C()if a and n then if not i then SendNUIMessage({anprShow=true})i=true end elseif i then SendNUIMessage({anprHide=true})i=false end end;CMG.createThreadOnTick(C)RegisterNetEvent("CMG:setFlagVehicles",function(D)g=D end)