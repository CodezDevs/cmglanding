local a={}Citizen.CreateThread(function()print("[CMG] Loading cached user data.")a=json.decode(GetResourceKvpString("cmg_userdata")or"{}")if type(a)~="table"then a={}print("[CMG] Loading cached user data - failed to load setting to default.")else print("[CMG] Loading cached user data - loaded.")end end)function CMG.updateCustomization(b)local c=tvRP.getCustomization()if c.modelhash~=0 and IsModelValid(c.modelhash)then a.customisation=c;if b then SetResourceKvp("cmg_userdata",json.encode(a))end end end;local d=vector3(0.0,0.0,0.0)function CMG.updatePos(b)local e=GetEntityCoords(PlayerPedId())if e.z>-150.0 and#(e-d)>15.0 then a.position=e;if b then SetResourceKvp("cmg_userdata",json.encode(a))end end end;function CMG.updateHealth(b)a.health=GetEntityHealth(PlayerPedId())if b then SetResourceKvp("cmg_userdata",json.encode(a))end end;Citizen.CreateThread(function()Wait(30000)while true do Wait(5000)if not CMG.inEvent()and not CMG.getEventLocalPlayer()then if not CMG.isInHouse()and not inOrganHeist and not CMG.isPlayerInRedZone()and not CMG.isInPaintball()and not CMG.isInSpectate()and not CMG.isInStoreTesting()then CMG.updatePos()end;if not globalInPrison and not CMG.isStaffedOn()and not CMG.isPlayerInAnimalForm()and not CMG.isInPaintball()then CMG.updateCustomization()end;CMG.updateHealth()end;SetResourceKvp("cmg_userdata",json.encode(a))end end)Houses={}selectedSpawnPos={}selectedSpawnPos["x"]=40.7706604004;selectedSpawnPos["y"]=-1390.8839111328;selectedSpawnPos["z"]=32.509273529052;showSpawnmenu=false;tempPosBlip={}local f;local g;function applySavedCustomisation()local c=a.customisation;if c==nil or c.modelhash==0 or not IsModelValid(c.modelhash)then tvRP.setCustomization(getDefaultCustomization(),true,true)else tvRP.setCustomization(c,true,true)end end;RegisterNetEvent("CMG:respawnClient",function(h)DoScreenFadeOut(250)CMG.hideUI()Wait(500)TriggerScreenblurFadeIn(100.0)local i=a.position or vector3(178.5132598877,-1007.5575561523,29.329647064209)applySavedCustomisation()RequestCollisionAtCoord(i.x,i.y,i.z)NewLoadSceneStartSphere(i.x,i.y,i.z,100.0,2)if not h then SetEntityCoordsNoOffset(PlayerPedId(),i.x,i.y,i.z,true,false,false)end;SetEntityVisible(PlayerPedId(),false,false)FreezeEntityPosition(PlayerPedId(),true)local j=GetGameTimer()while(not HaveAllStreamingRequestsCompleted(PlayerPedId())or GetNumberOfStreamingRequests()>0)and GetGameTimer()-j<10000 do Wait(0)print("[CMG] Waiting for streaming requests to complete!")end;NewLoadSceneStop()TriggerEvent("CMG:playGTAIntro")DoScreenFadeIn(1000)ShutdownLoadingScreen()ShutdownLoadingScreenNui()if not CMG.isDevMode()then SetFocusPosAndVel(i.x,i.y,i.z+1000)f=CreateCameraWithParams("DEFAULT_SCRIPTED_CAMERA",i.x,i.y,i.z+1000,0.0,0.0,0.0,65.0,0,2)SetCamActive(f,true)RenderScriptCams(true,true,0,1,0)g=CreateCameraWithParams("DEFAULT_SCRIPTED_CAMERA",i.x,i.y,i.z,0.0,0.0,0.0,65.0,0,2)SetCamActiveWithInterp(g,f,5000,0,0)Wait(2500)ClearFocus()TriggerScreenblurFadeOut(2000.0)Wait(2000)DestroyCam(f)DestroyCam(g)RenderScriptCams(false,true,2000,0,0)else TriggerScreenblurFadeOut(500.0)end;print("[CMG] cachedUserData.health",a.health)SetEntityHealth(PlayerPedId(),a.health or 200)SetEntityVisible(PlayerPedId(),true,false)FreezeEntityPosition(PlayerPedId(),false)if not CMG.isDevMode()then Citizen.Wait(2000)end;CMG.showUI()TriggerServerEvent("CMG:playerRespawned")end)RegisterNetEvent("CMG:setOverlay",function(k)if k then dad=k["dad"]or 0;mum=k["mum"]or 0;skin=k["skin"]or 0;dadmumpercent=k["dadmumpercent"]or 0;eyecolor=k["eyecolor"]or 0;acne=k["acne"]or 0;skinproblem=k["skinproblem"]or 0;freckle=k["freckle"]or 0;wrinkle=k["wrinkle"]or 0;wrinkleopacity=k["wrinkleopacity"]or 0;hair=k["hair"]or 0;haircolor=k["haircolor"]or 0;eyebrow=k["eyebrow"]or 0;eyebrowopacity=k["eyebrowopacity"]or 0;beard=k["beard"]or 0;beardopacity=k["beardopacity"]or 0;beardcolor=k["beardcolor"]or 0;eyeshadow=k["eyeshadow"]or 0;lipstick=k["lipstick"]or 0;eyeshadowcolour=k["eyeshadowcolour"]or 0;lipstickcolour=k["lipstickcolour"]or 0;SetPedHeadBlendData(GetPlayerPed(-1),dad,mum,0,skin,skin,skin,dadmumpercent,dadmumpercent,0.0,false)SetPedEyeColor(GetPlayerPed(-1),eyecolor)if acne==0 then SetPedHeadOverlay(GetPlayerPed(-1),0,acne,0.0)else SetPedHeadOverlay(GetPlayerPed(-1),0,acne,1.0)end;SetPedHeadOverlay(GetPlayerPed(-1),6,skinproblem,1.0)if freckle==0 then SetPedHeadOverlay(GetPlayerPed(-1),9,freckle,0.0)else SetPedHeadOverlay(GetPlayerPed(-1),9,freckle,1.0)end;SetPedHeadOverlay(GetPlayerPed(-1),3,wrinkle,wrinkleopacity*0.1)SetPedComponentVariation(GetPlayerPed(-1),2,hair,0,2)SetPedHairColor(GetPlayerPed(-1),haircolor,haircolor)SetPedHeadOverlay(GetPlayerPed(-1),2,eyebrow,eyebrowopacity*0.1)SetPedHeadOverlay(GetPlayerPed(-1),1,beard,beardopacity*0.1)SetPedHeadOverlayColor(GetPlayerPed(-1),1,1,beardcolor,beardcolor)SetPedHeadOverlayColor(GetPlayerPed(-1),2,1,beardcolor,beardcolor)eyeShadowOpacity=1.0;if eyeshadow==0 then eyeShadowOpacity=0.0 end;lipstickOpacity=1.0;if lipstick==0 then lipstickOpacity=0.0 end;SetPedHeadOverlay(GetPlayerPed(-1),4,eyeshadow,eyeShadowOpacity)SetPedHeadOverlay(GetPlayerPed(-1),8,lipstick,lipstickOpacity)SetPedHeadOverlayColor(GetPlayerPed(-1),4,1,eyeshadowcolour,eyeshadowcolour)SetPedHeadOverlayColor(GetPlayerPed(-1),8,1,lipstickcolour,lipstickcolour)end end)Citizen.CreateThread(function()local l={{-815.59008789063,-182.16806030273,37.568920135498},{139.21583557129,-1708.9689941406,29.301620483398},{-1281.9802246094,-1119.6861572266,7.0001249313354},{1934.115234375,3730.7399902344,32.854434967041},{1211.0759277344,-475.00064086914,66.218032836914},{-34.97777557373,-150.9037322998,57.086517333984},{-280.37301635742,6227.017578125,31.705526351929}}for m,n in pairs(l)do tvRP.addBlip(n[1],n[2],n[3],71,13,"Barber Shop")end end)local o=true;local p=0;function tvRP.canAnim()return o end;function tvRP.setCanAnim(q)if q then if p>0 then p=p-1 end;if p==0 then o=true else print(string.format("Can not setCanAnim(true) as %d other references exist",p))end else p=p+1;o=false end end;function getDefaultCustomization()local r={}r={}r.model="mp_m_freemode_01"for s=0,19 do r[s]={0,0}end;r[0]={0,0}r[1]={0,0}r[2]={47,0}r[3]={5,0}r[4]={4,0}r[5]={0,0}r[6]={7,0}r[7]={51,0}r[8]={0,240}r[9]={0,1}r[10]={0,0}r[11]={5,0}r[12]={4,0}r[15]={0,2}return r end;AddEventHandler("CMG:playGTAIntro",function()if not CMG.isDevMode()then SendNUIMessage({transactionType="gtaloadin"})end end)