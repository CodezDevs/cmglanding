local a=module("cfg/cfg_emotes")RMenu.Add("emotesmenu","mainmenu",RageUI.CreateMenu("CMG Emotes","Main Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","emotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","mainmenu"),"CMG Emotes","Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","danceemotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","emotes"),"CMG Emotes","Dance Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","customemotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","emotes"),"CMG Emotes","Custom Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","gunemotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","emotes"),"CMG Emotes","Gun Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","propemotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","emotes"),"CMG Emotes","Prop Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","sharedemotes",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","emotes"),"CMG Emotes","Shared Emotes",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","walkingstyles",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","mainmenu"),"CMG Emotes","Walking Styles",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))RMenu.Add("emotesmenu","moods",RageUI.CreateSubMenu(RMenu:Get("emotesmenu","mainmenu"),"CMG Emotes","Moods",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"shopui_title_sm_hangar","shopui_title_sm_hangar"))local b=false;local c=""local d={}local e=0;local f=nil;local g=nil;local h=nil;local i=nil;local j=nil;local k=0;local l=nil;local m=0;local n=0;local function o()for p,prop in pairs(d)do DeleteEntity(prop)end;d={}end;local function q(r)if not b then return end;if not r and GetGameTimer()-e<1500 and not CMG.isDeveloper(CMG.getUserId())then notify("~r~Emotes are being rate limited.")return end;b=false;f=nil;g=nil;h=nil;if i then if i.handle then StopParticleFxLooped(i.handle)end;i=nil end;if c=="Scenario"or c=="MaleScenario"then ClearPedTasksImmediately(PlayerPedId())else ClearPedTasks(PlayerPedId())o()end end;local function s(t,u,v,w,x,y,z,A)local B=PlayerPedId()local C=GetEntityCoords(B,true)local D=CMG.loadModel(t)prop=CreateObject(GetHashKey(t),C.x,C.y,C.z+0.2,true,true,true)AttachEntityToEntity(prop,B,GetPedBoneIndex(B,u),v,w,x,y,z,A,true,true,false,true,1,true)table.insert(d,prop)SetModelAsNoLongerNeeded(D)end;local function E(F)SetFacialIdleAnimOverride(PlayerPedId(),F[2],nil)b=true end;local function G(F)if CMG.getPlayerVehicle()~=0 then notify("~r~Can not use scenarios whilst in a vehicle.")return end;local B=PlayerPedId()if F[1]=="Scenario"then ClearPedTasks(B)TaskStartScenarioInPlace(B,F[2],0,true)elseif F[1]=="MaleScenario"then if CMG.getModelGender()=="male"then ClearPedTasks(B)TaskStartScenarioInPlace(B,F[2],0,true)else notify("~r~This scenario is male only.")end elseif F[1]=="ScenarioObject"then local H=GetOffsetFromEntityInWorldCoords(B,0.0,0-0.5,-0.5)ClearPedTasks(B)TaskStartScenarioAtPosition(B,F[2],H.x,H.y,H.z,GetEntityHeading(B),0,true,false)end;b=true end;local function I(F)local J=F.animationOptions;if CMG.getPlayerVehicle()~=0 then return 51 elseif not J then return 0 elseif J.emoteLoop then if J.emoteMoving then return 51 else return 1 end elseif J.emoteMoving then return 51 elseif not J.emoteMoving then return 0 elseif J.emoteStuck then return 50 end;return 0 end;local function K(F)if F.animationOptions then return F.animationOptions.emoteDuration or-1 else return-1 end end;local function L(F)local J=F.animationOptions;if not J then return end;local M=J.prop;if not M then return end;local N=J.propBone;local O,P,Q,R,S,T=table.unpack(J.propPlacement)s(M,N,O,P,Q,R,S,T)local U=J.secondProp;if not U then return end;local V=J.secondPropBone;local W,X,Y,Z,_,a0=table.unpack(J.secondPropPlacement)s(U,V,W,X,Y,Z,_,a0)end;local function a1(F)local a2,a3=table.unpack(F)local a4=I(F)local a5=K(F)CMG.loadAnimDict(a2)TaskPlayAnim(PlayerPedId(),a2,a3,2.0,2.0,a5,a4,0,false,false,false)RemoveAnimDict(a2)Citizen.Wait(0)b=true;f=a2;g=a3;h=F;local a6=F.animationOptions;if a6 and a6.ptfxAsset then i={asset=a6.ptfxAsset,name=a6.ptfxName,placement=a6.ptfxPlacement,info=a6.ptfxInfo,wait=a6.ptfxWait}notify(i.info)end;L(F)end;local a7={2,160,161,163,167}local function a8(F)if not tvRP.canAnim()or tvRP.isHandcuffed()or CMG.inEvent()then return true end;local B=PlayerPedId()if IsPedReloading(B)or IsPlayerFreeAiming(B)or GetEntityHealth(B)<=102 then return true end;if CMG.getPlayerCombatTimer()>0 then return true end;local a9=CMG.getPlayerVehicle()if a9~=0 and GetEntitySpeed(a9)>1.0 then return true end;for p,aa in pairs(a7)do if GetIsTaskActive(B,aa)then return true end end;if isPlayerNearPrison()then if F and F.animationOptions and F.animationOptions.allowedPrison then return false else return true end end;return false end;local function ab(F)if a8(F)then notify("~r~Can not use this emote at this time.")return end;if GetGameTimer()-e<1500 and not CMG.isDeveloper(CMG.getUserId())then notify("~r~Emotes are being rate limited.")return end;q(true)local type=F[1]c=type;e=GetGameTimer()if type=="Expression"then E(F)return end;if type=="Scenario"or type=="MaleScenario"or type=="ScenarioObject"then G(F)return end;a1(F)end;local function ac()local ad=PlayerId()local ae=-1;local af=2.0;local ag=CMG.getPlayerCoords()for p,ah in pairs(GetActivePlayers())do if ah~=ad then local ai=GetPlayerPed(ah)local aj=#(GetEntityCoords(ai,true)-ag)if aj<af then ae=ah;af=aj end end end;if ae==-1 then return 0 else return GetPlayerServerId(ae)end end;local function ak(al)if a8()then notify("~r~Can not use shared emotes at this time.")return end;local am=ac()if am~=0 then j=al;k=am;TriggerServerEvent("CMG:sendSharedEmoteRequest",am,al)else notify("~r~No player is near by.")end end;local function an(F)Citizen.CreateThreadNow(function()local ao=F[1]CMG.loadAnimDict(ao)SetPedMovementClipset(PlayerPedId(),ao,0.2)RemoveAnimSet(ao)RemoveAnimDict(ao)end)end;local function ap(aq,ar)local as,at=type(aq),type(ar)if as~=at then return as<at else return aq<ar end end;local function au(av,aw)local ax={}local ay=1;for az in pairs(av)do ax[ay]=az;ay=ay+1 end;aw=aw or ap;table.sort(ax,aw)return ax end;local function aA(av,aw)local ax=au(av,aw)local aB=0;return function()aB=aB+1;local az=ax[aB]if az~=nil then return az,av[az]else return nil,nil end end end;RageUI.CreateWhile(1.0,RMenu:Get("emotesmenu","mainmenu"),nil,function()RageUI.IsVisible(RMenu:Get("emotesmenu","mainmenu"),true,false,true,function()if CMG.isNewPlayer()then drawNativeNotification("Press ~INPUT_A6B0CFFB~ to toggle the Emote Menu.")end;RageUI.Button("Emotes","",true,function()end,RMenu:Get("emotesmenu","emotes"))RageUI.Button("Cancel Emotes","",true,function(aC,aD,aE)if aE then q(false)e=GetGameTimer()end end)RageUI.Button("Walking Styles","",true,function()end,RMenu:Get("emotesmenu","walkingstyles"))RageUI.Button("Moods","",true,function()end,RMenu:Get("emotesmenu","moods"))end)RageUI.IsVisible(RMenu:Get("emotesmenu","emotes"),true,false,true,function()RageUI.Button("🕺 Dance Emotes","",true,function()end,RMenu:Get("emotesmenu","danceemotes"))RageUI.Button("🛠️ Custom Emotes","",true,function()end,RMenu:Get("emotesmenu","customemotes"))RageUI.Button("📦 Prop Emotes","",true,function()end,RMenu:Get("emotesmenu","propemotes"))RageUI.Button("👫 Shared Emotes","",true,function()end,RMenu:Get("emotesmenu","sharedemotes"))RageUI.Button("🔫 Gun Emotes","",true,function()end,RMenu:Get("emotesmenu","gunemotes"))for aF,F in aA(a.emotes)do RageUI.Button(F[3],"/e ("..aF..")",not a8(F),function(aC,aD,aE)if aE then ab(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","danceemotes"),true,false,true,function()for aF,F in aA(a.dances)do RageUI.Button(F[3],"/e ("..aF..")",not a8(F),function(aC,aD,aE)if aE then ab(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","customemotes"),true,false,true,function()for aF,F in aA(a.custom)do RageUI.Button(F[3],"/e ("..aF..")",not a8(F),function(aC,aD,aE)if aE then ab(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","gunemotes"),true,false,true,function()for aF,F in aA(a.guns)do RageUI.Button(F[3],"/e ("..aF..")",not a8(F),function(aC,aD,aE)if aE then ab(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","propemotes"),true,false,true,function()for aF,F in aA(a.props)do RageUI.Button(F[3],"/e ("..aF..")",not a8(F),function(aC,aD,aE)if aE then ab(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","sharedemotes"),true,false,true,function()for al,F in aA(a.shared)do if not F.animationOptions or not F.animationOptions.invisible then RageUI.Button(F[3],"/nearby (~g~"..al.."~w~)",not a8(F),function(aC,aD,aE)if aE then ak(al)end end)end end end)RageUI.IsVisible(RMenu:Get("emotesmenu","walkingstyles"),true,false,true,function()RageUI.Button("Normal (Reset)","",not a8(nil),function(aC,aD,aE)if aE then ResetPedMovementClipset(PlayerPedId())end end)for al,F in aA(a.walks)do RageUI.Button(al,"",not a8(F),function(aC,aD,aE)if aE then an(F)end end)end end)RageUI.IsVisible(RMenu:Get("emotesmenu","moods"),true,false,true,function()RageUI.Button("Normal (Reset)","",true,function(aC,aD,aE)if aE then ClearFacialIdleAnimOverride(PlayerPedId())end end)for al,F in aA(a.moods)do RageUI.Button(al,"",true,function(aC,aD,aE)if aE then ab(F)end end)end end)end)RegisterCommand("emotemenu",function(aG,aH,aI)RageUI.Visible(RMenu:Get("emotesmenu","mainmenu"),not RageUI.Visible(RMenu:Get("emotesmenu","mainmenu")))end,false)RegisterKeyMapping("emotemenu","Toggles the emote menu","KEYBOARD","F3")local function aJ(aG,aH,aI)if#aH<1 then notify("~r~No emote name was specified.")return end;local al=string.lower(aH[1])if not al then notify("~r~No emote name was specified.")return elseif al=="c"then q(false)return end;if a.emotes[al]then ab(a.emotes[al])elseif a.dances[al]then ab(a.dances[al])elseif a.custom[al]then ab(a.custom[al])elseif a.props[al]then ab(a.props[al])elseif a.guns[al]then ab(a.guns[al])else notify("~r~Invalid emote name was specified.")end end;RegisterCommand("e",aJ,false)RegisterCommand("emote",aJ,false)RegisterCommand("nearby",function(aG,aH,aI)if#aH<1 then notify("~r~No emote name was specified.")return end;local al=string.lower(aH[1])if not al then notify("~r~No emote name was specified.")return end;if a.shared[al]then ak(al)else notify("~r~Invalid emote name was specified.")end end)RegisterCommand("walk",function(aG,aH,aI)if#aH<1 then notify("~r~No walk name was specified.")return end;local al=aH[1]if not al then notify("~r~No walk name was specified.")return end;if a.walks[al]then if not a8(a.walks[al])then an(a.walks[al])else notify("~r~You can not use emotes at this time.")end else notify("~r~Invalid walk name was specified.")end end,false)RegisterNetEvent("CMG:sendSharedEmoteRequest",function(aK,al)if a.shared[al]and not a8()then l=al;m=aK;n=GetGameTimer()notify("~y~Y~w~ to accept, ~r~L~w~ to refuse (~g~"..a.shared[al][3].."~w~)")end end)RegisterNetEvent("CMG:receiveSharedEmoteRequest",function(al)q(false)Citizen.Wait(300)ab(a.shared[al])end)RegisterNetEvent("CMG:receiveSharedEmoteRequestSource",function()local aL=GetPlayerFromServerId(k)if aL==-1 then return end;local aM=GetPlayerPed(aL)if aM==0 then return end;local aN=GetEntityHeading(aM)local C=GetOffsetFromEntityInWorldCoords(aM,0.0,1.0,0.0)local F=a.shared[j]if F.animationOptions and F.animationOptions.syncOffsetFront then C=GetOffsetFromEntityInWorldCoords(aM,0.0,F.animationOptions.syncOffsetFront,0.0)end;local B=PlayerPedId()SetEntityHeading(B,aN-180.1)SetEntityCoordsNoOffset(B,C.x,C.y,C.z,0)q(false)Citizen.Wait(300)ab(F)end)local function aO()l=nil;m=0;n=0 end;local function aP()if i.handle then return end;CMG.loadPtfx(i.asset)if not i then return end;UseParticleFxAsset(i.asset)local aQ,aR,aS,aT,aU,aV,aW=table.unpack(i.placement)i.handle=StartNetworkedParticleFxLoopedOnEntityBone(i.name,PlayerPedId(),aQ,aR,aS,aT,aU,aV,GetEntityBoneIndexByName(i.name,"VFX"),1065353216,0,0,0,1065353216,1065353216,1065353216,0)Citizen.CreateThread(function()if i then SetParticleFxLoopedColour(i.handle,1.0,1.0,1.0,false)Citizen.Wait(i.wait)if i then StopParticleFxLooped(i.handle)i.handle=nil end end end)end;local function aX()if l then if GetGameTimer()-n>5000 then aO()elseif IsControlJustPressed(1,246)then if a8()then notify("~r~You can not use emotes at this time.")else TriggerServerEvent("CMG:receiveSharedEmoteRequest",m,a.shared[l][4])end;aO()end end;if b and f and g then if i and IsControlJustPressed(0,47)then aP()end;if not IsEntityPlayingAnim(PlayerPedId(),f,g,3)or a8(h)then q(true)end end end;function CMG.playEmote(al)if a.emotes[al]then ab(a.emotes[al])elseif a.dances[al]then ab(a.dances[al])elseif a.custom[al]then ab(a.custom[al])elseif a.props[al]then ab(a.props[al])elseif a.guns[al]then ab(a.guns[al])end end;CMG.cancelEmote=q;Citizen.CreateThread(function()TriggerEvent("chat:addSuggestion","/e","Play an emote",{{name="emotename",help="dance, camera, sit or any valid emote."}})TriggerEvent("chat:addSuggestion","/emote","Play an emote",{{name="emotename",help="dance, camera, sit or any valid emote."}})TriggerEvent("chat:addSuggestion","/emotemenu","Open emotes menu (F3) by default.")TriggerEvent("chat:addSuggestion","/walk","Set your walkingstyle.",{{name="style",help="/walks for a list of valid styles"}})CMG.createThreadOnTick(aX)end)