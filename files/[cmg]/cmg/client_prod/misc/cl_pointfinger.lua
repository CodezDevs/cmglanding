local a=false;local function b()local c=CMG.getPlayerPed()CMG.setWeapon(c,`WEAPON_UNARMED`,true)CMG.loadAnimDict("anim@mp_point")SetPedCurrentWeaponVisible(c,0,1,1,1)SetPedConfigFlag(c,36,1)TaskMoveNetworkByName(c,"task_mp_pointing",0.5,0,"anim@mp_point",24)RemoveAnimDict("anim@mp_point")end;local function d()local c=CMG.getPlayerPed()RequestTaskMoveNetworkStateTransition(c,"Stop")if not IsPedInjured(c)then ClearPedSecondaryTask(c)end;if not IsPedInAnyVehicle(c,1)then SetPedCurrentWeaponVisible(c,1,1,1,1)end;SetPedConfigFlag(c,36,0)ClearPedSecondaryTask(c)end;RegisterCommand("pointfinger",function()local e=PlayerPedId()local f,g=GetCurrentPedWeapon(e,true)if IsPedOnFoot(e)and not f and g==`WEAPON_UNARMED`then if a then a=false;d()else a=true;b()end end end,false)RegisterKeyMapping("pointfinger","Point Finger","KEYBOARD","B")local function h(i)if a then local c=i.playerPed;local j=GetGameplayCamRelativePitch()if j<-70.0 then j=-70.0 elseif j>42.0 then j=42.0 end;j=(j+70.0)/112.0;local k=GetGameplayCamRelativeHeading()local l=Cos(k)local m=Sin(k)if k<-180.0 then k=-180.0 elseif k>180.0 then k=180.0 end;k=(k+180.0)/360.0;local n=0;local o=GetOffsetFromEntityInWorldCoords(c,l*-0.2-m*(0.4*k+0.3),m*-0.2+l*(0.4*k+0.3),0.6)local p=StartShapeTestCapsule(o.x,o.y,o.z-0.2,o.x,o.y,o.z+0.2,0.4,95,c,7)nn,n,o,o=GetShapeTestResult(p)SetTaskMoveNetworkSignalFloat(c,"Pitch",j)SetTaskMoveNetworkSignalFloat(c,"Heading",k*-1.0+1.0)SetTaskMoveNetworkSignalBool(c,"isBlocked",n)SetTaskMoveNetworkSignalBool(c,"isFirstPerson",GetCamViewModeForContext(GetCamActiveViewModeContext())==4)end end;CMG.createThreadOnTick(h)