piggyBackInProgress=false;local a=""local b=""local c=0;local d=false;RegisterCommand("piggyback",function(e,f)if not isPlayerNearPrison()then local g=CMG.getPlayerPed()if IsPedInAnyVehicle(g,false)then drawNativeNotification("Can't piggy back someone whilst your in a vehicle")else local h=CMG.getPlayerCoords()local i=vector3(1121.7922363281,239.42251586914,-50.440742492676)local j=#(h-i)if GetEntityHealth(g)>102 and not insideDiamondCasino then if not piggyBackInProgress then local k=GetClosestPlayer(3)target=GetPlayerServerId(k)if k and k~=-1 then TriggerServerEvent("CMG:requestPiggyback",target)else drawNativeNotification("No one nearby to piggyback!")end else piggyBackInProgress=false;ClearPedSecondaryTask(g)DetachEntity(g,true,false)local k=GetClosestPlayer(3)target=GetPlayerServerId(k)if target~=0 then TriggerServerEvent("CMG:piggybackStop",target)end end end end else tvRP.notify("~r~You cannot do this in prison.")end end,false)RegisterNetEvent("CMG:piggybackRequest",function()tvRP.notify("Someone is trying to piggyback you, press (~y~Y~w~) to accept (~r~L~w~) to refuse")d=true;Citizen.CreateThread(function()while d do if IsControlJustPressed(0,246)then tvRP.notify("~g~Request Accepted")ExecuteCommand("pbaccept")d=false elseif IsControlJustPressed(0,182)then tvRP.notify("~g~Request Refused")ExecuteCommand("pbrefuse")d=false end;Wait(0)end end)Citizen.Wait(15000)d=false end)function func_piggyBackVehicleCheck(l)if piggyBackInProgress then if IsPedGettingIntoAVehicle(l.playerPed)then TriggerServerEvent("CMG:piggybackStop",target)piggyBackInProgress=false;ClearPedTasks(l.playerPed)drawNativeNotification("Can't piggy back someone whilst your in a vehicle")end;DisablePlayerFiring(CMG.getPlayerId(),true)if not IsEntityPlayingAnim(l.playerPed,b,a,3)then TaskPlayAnim(l.playerPed,b,a,8.0,-8.0,100000,c,0,false,false,false)end end end;CMG.createThreadOnTick(func_piggyBackVehicleCheck)RegisterNetEvent("CMG:piggybackSyncTarget",function(target,m,n,o,p,q,r,s,t)local u=CMG.getPlayerPed()local v=GetPlayerPed(GetPlayerFromServerId(target))RequestAnimDict(m)piggyBackInProgress=true;while not HasAnimDictLoaded(m)do Citizen.Wait(10)end;if s==nil then s=180.0 end;AttachEntityToEntity(u,v,0,p,o,q,0.5,0.5,s,false,false,false,false,2,false)if t==nil then t=0 end;TaskPlayAnim(u,m,n,8.0,-8.0,r,t,0,false,false,false)RemoveAnimDict(m)a=n;b=m;c=t end)RegisterNetEvent("CMG:piggybackSyncMe",function(m,w,r,t,x)local u=CMG.getPlayerPed()RequestAnimDict(m)piggyBackInProgress=true;while not HasAnimDictLoaded(m)do Citizen.Wait(10)end;Wait(500)if t==nil then t=0 end;TaskPlayAnim(u,m,w,8.0,-8.0,r,t,0,false,false,false)RemoveAnimDict(m)a=w;b=m;c=t end)RegisterNetEvent("CMG:piggybackClientStop",function()piggyBackInProgress=false;ClearPedSecondaryTask(CMG.getPlayerPed())DetachEntity(CMG.getPlayerPed(),true,false)end)