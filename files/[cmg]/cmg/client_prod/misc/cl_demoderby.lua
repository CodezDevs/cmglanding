local a=module("cfg/events/cfg_demoderby")local b={location=1,playersSelected=2,carSelected=1,teamsSelected=1,roundsSelected=1}local c=""local d=0;local e=0;local f;local g=false;local h={[1]=0,[2]=0,[3]=0,[4]=0}local i;Citizen.CreateThread(function()RequestStreamedTextureDict("demoDerbyTextures")while not HasStreamedTextureDictLoaded("demoDerbyTextures")do Citizen.Wait(0)end end)local function j(k)CMG.stopEventSequence(true)Citizen.Wait(2000)print(json.encode(f))tvRP.teleport(f.coords.x,f.coords.y,f.coords.z+3)Citizen.Wait(500)i=CMG.spawnVehicle(e,f.coords.x,f.coords.y,f.coords.z,f.heading,true,true,false)FreezeEntityPosition(i,true)if d==1 then SetVehicleColours(i,30,30)elseif d==2 then SetVehicleColours(i,55,55)elseif d==3 then SetVehicleColours(i,70,70)elseif d==4 then SetVehicleColours(i,130,130)end;if k then local l=math.floor(15000/(#a[c].cameraTransitionCoords/2))local m={}for n=1,#a[c].cameraTransitionCoords,1 do m[n]=CreateCamWithParams("DEFAULT_SCRIPTED_CAMERA",a[c].cameraTransitionCoords[n].placementCoords,0.0,0.0,0.0,65.0,0,2)PointCamAtCoord(m[n],a[c].cameraTransitionCoords[n].pointAt)if n%2==0 then SetCamActive(m[n-1],true)RenderScriptCams(true,true,0,1,0)SetCamActiveWithInterp(m[n],m[n-1],l,5,5)Citizen.Wait(l)DestroyCam(m[n],0)DestroyCam(m[n-1],0)RenderScriptCams(false,false,0,1,0)end end end;SetGameplayCamRelativeHeading(0)CMG.showCountdownTimer(10)FreezeEntityPosition(i,false)end;RegisterNetEvent("CMG:demoDerbyStart",function(o,p,q)c=q.location;d=o;e=GetHashKey(q.car)f=p;globalDisableVehicleFailure=true;Citizen.CreateThread(function()while currentEvent.isActive do DisableControlAction(0,75)Wait(0)end end)local r=function()local i=CMG.getPlayerVehicle()if i~=0 then AddOwnedExplosion(PlayerPedId(),CMG.getPlayerCoords().x,CMG.getPlayerCoords().y,CMG.getPlayerCoords().z-5.0,4,1000.0,true,false,true)SetEntityHealth(PlayerPedId(),0)Citizen.CreateThread(function()Citizen.Wait(2000)tvRP.teleport(a[c].middleCoords.x,a[c].middleCoords.y,a[c].middleCoords.z)tvRP.toggleNoclip()g=true end)end;if g then tvRP.teleport(a[c].middleCoords.x,a[c].middleCoords.y,a[c].middleCoords.z)end end;local s=function()local i=CMG.getPlayerVehicle()if GetVehicleEngineHealth(i)<=150 or GetVehicleBodyHealth(i)==0 then AddOwnedExplosion(PlayerPedId(),CMG.getPlayerCoords(),4,1000.0,true,false,true)SetEntityHealth(PlayerPedId(),0)g=true end end;CMG.createArea("demoDerbyChecks",a[c].middleCoords,100,100,function()end,r,s,{})j(true)end)RegisterNetEvent("CMG:demoDerbyStartNewRound",function()if noclipActive then tvRP.toggleNoclip()end;DeleteEntity(i)j()end)RegisterNetEvent("CMG:demoDerbyUpdateTeams",function(o,t)h[o]=t end)