local a={}local b={}local c=false;local d;local e=25.0;local f=219;local g=105;local h=97;local i=255;local j=4;local k=0.5;local l=0.9;local m=0.92;Citizen.CreateThread(function()while true do local n=CMG.getPlayerPed()local o=GetVehiclePedIsIn(CMG.getPlayerPed(),false)if o~=0 and GetPedInVehicleSeat(o,-1)==n then local p,q=tvRP.getVehicleInfos(o)if p==CMG.getUserId()then if a[q]then local r=a[q]d=q;c=true;while GetVehiclePedIsIn(CMG.getPlayerPed(),false)~=0 do Wait(1000)end;c=false;offset=r-a[q]TriggerServerEvent("CMG:updateNitro",q,-offset)end end end;Wait(0)end end)local s={"exhaust","exhaust_2","exhaust_3","exhaust_4"}local t="veh_backfire"local u="core"local v=2.4;local w={"overheat"}local x="ent_sht_steam"local y="core"local z=0.4;local function A(B,C)local D=GetEntityBoneIndexByName(B,C)CMG.loadPtfx("core")UseParticleFxAsset("core")local E=StartParticleFxLoopedOnEntityBone("veh_light_red_trail",B,0.0,0.0,0.0,0.0,0.0,0.0,D,1.0,false,false,false)SetParticleFxLoopedEvolution(E,"speed",1.0,false)RemoveNamedPtfxAsset("core")return E end;local function F(B,G,H,I,J,K,L)CMG.loadPtfx("core")UseParticleFxAsset("core")local E=StartParticleFxLoopedOnEntity("ent_sht_steam",B,G,H,I,J,K,L,0.5,false,false,false)RemoveNamedPtfxAsset("core")return E end;local function M(B)if b[B]then return end;local N={}N.leftTrail=A(B,"taillight_l")N.rightTrail=A(B,"taillight_r")local O=GetEntityBoneIndexByName(B,"bonnet")local P=GetWorldPositionOfEntityBone(B,O)local Q=GetOffsetFromEntityGivenWorldCoords(B,P.x,P.y,P.z)N.purge={}for R=0,3 do local S=F(B,Q.x-0.5,Q.y+0.05,Q.z,40.0,-20.0,0.0)table.insert(N.purge,S)local T=F(B,Q.x+0.5,Q.y+0.05,Q.z,40.0,20.0,0.0)table.insert(N.purge,T)end;b[B]=N end;local function U(E)Citizen.CreateThread(function()local V=GetGameTimer()+500;while GetGameTimer()<V do local W=GetGameTimer()local X=(V-W)/500;SetParticleFxLoopedScale(E,X)SetParticleFxLoopedAlpha(E,X)Citizen.Wait(0)end;StopParticleFxLooped(E)end)end;local function Y(B)local N=b[B]if not N then return end;U(N.leftTrail)U(N.rightTrail)for R,E in pairs(N.purge)do StopParticleFxLooped(E)end end;local function Z(B)if not IsVehicleStopped(B)then local _=GetEntityModel(B)local a0=GetEntitySpeed(B)local a1=GetVehicleModelEstimatedMaxSpeed(_)local a2=4.0*a1/a0;SetVehicleCheatPowerIncrease(B,a2)end end;function func_drawNitroText()if c and a[d]>0 then local a3=a[d]if a3<0 then a3=0 end;CMG.DrawText(l,m,"Nitro: "..math.floor(tonumber(a3)).."%",k,j,1,{f,g,h,i},true)local o=GetVehiclePedIsIn(CMG.getPlayerPed(),false)if IsControlPressed(0,21)then if a[d]-0.05>=0 then M(o)Z(o)AnimpostfxPlay("RaceTurbo",0,0)a[d]=a[d]-0.05;if not nitroEventDelay then nitroEventDelay=true;vehicleFlameExhaustEffect(o)vehiclePurgeExhaustEffect(o)exhaustSoundStart(o)SetTimeout(100,function()nitroEventDelay=false end)end else a[d]=0;StopGameplayCamShaking(true)SetVehicleCheatPowerIncrease(o,1.0)SetVehicleBoostActive(o,false)AnimpostfxStop("RaceTurbo")end else SetVehicleCheatPowerIncrease(o,1.0)exhaustSoundStop(o)Y(o)end end end;CMG.createThreadOnTick(func_drawNitroText)function vehicleFlameExhaustEffect(B)for R,a4 in pairs(s)do UseParticleFxAsset(u)createdPart=StartParticleFxLoopedOnEntityBone(t,B,0.0,0.0,0.0,0.0,0.0,0.0,GetEntityBoneIndexByName(B,a4),v,0.0,0.0,0.0)StopParticleFxLooped(createdPart,1)end end;function vehiclePurgeExhaustEffect(B)for R,a4 in pairs(w)do UseParticleFxAsset(y)createdPart=StartParticleFxLoopedOnEntityBone(x,B,0.0,0.0,0.0,0.0,0.0,0.0,GetEntityBoneIndexByName(B,a4),z,0.0,0.0,0.0)StopParticleFxLooped(createdPart,1)end end;function exhaustSoundStart(B)SetVehicleBoostActive(B,1)end;function exhaustSoundStop(B)SetVehicleBoostActive(B,0)end;function setVehicleIdNitro(q,a5)a[q]=a5;if a[q]>100 then a[q]=100 end end;function addVehicleIdNitro(q,a5)a[q]=a[q]+a5;if a[q]>100 then a[q]=100 end end;function getVehicleIdNitro(q)return a[q]end