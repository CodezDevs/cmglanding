local a={}function CMG.startVehicleSelection(b,c,d,e,f,g)a.position=b;a.heading=c;a.vehicles=d;a.duration=e;a.cbVehicleChanged=f;a.cbColourChanged=g;a.colourListIndex=1;a.lastVehicleName=nil;a.selectedVehicleName=nil;a.lastDecreased=GetGameTimer()a.orders={}a.prevHasControl=IsPlayerControlOn(PlayerId())a.prevShowingUI=globalHideUi;SetPlayerControl(PlayerId(),false,0)for h,i in pairs(a.vehicles)do if not table.find(a.orders,i.level)then table.insert(a.orders,i.level)end end;table.sort(a.orders,function(j,k)return j<k end)local l=b+vector3(math.cos(math.rad(c+70.0)),math.sin(math.rad(c+70.0)),0.0)*5.0;a.camera=CreateCamWithParams("DEFAULT_SCRIPTED_CAMERA",l.x,l.y,l.z+2.0,0.0,0.0,0.0,70.0,false,2)SetCamActive(a.camera,true)PointCamAtCoord(a.camera,a.position.x,a.position.y,a.position.z)RenderScriptCams(true,false,0,false,false)for h,i in pairs(a.vehicles)do CMG.loadModel(i.model)end;RageUI.Visible(RMenu:Get("selection","mainmenu"),true)end;function CMG.endVehicleSelection()if a.camera then RageUI.Visible(RMenu:Get("selection","mainmenu"),false)for h,i in pairs(a.vehicles)do SetModelAsNoLongerNeeded(i.model)end;DeleteEntity(a.previewVehicle)SetCamActive(a.camera,false)RenderScriptCams(false,false,0,false,false)DestroyCam(a.camera,false)if a.prevHasControl then SetPlayerControl(PlayerId(),true,0)end;globalHideUi=a.prevShowingUI;for h,m in pairs(GetActivePlayers())do local n=GetPlayerPed(m)if n~=0 then SetEntityVisible(n,true,false)end end end;a={}end;RegisterNetEvent("CMG:vehicleSelectionSetVotes",function(o)a.votes=o end)local p={"White","Black","Red","Green","Blue","Yellow","Purple","Pink"}local function q(r)if r==1 then return 111 elseif r==2 then return 147 elseif r==3 then return 39 elseif r==4 then return 92 elseif r==5 then return 83 elseif r==6 then return 42 elseif r==7 then return 145 elseif r==8 then return 135 end end;Citizen.CreateThread(function()while true do if a.camera then globalHideUi=true;DisableAllControlActions(0)local s=GetGameTimer()if s-a.lastDecreased>=1000 then if a.duration>0 then a.duration=a.duration-1 end;if a.duration<5 then PlaySoundFrontend(-1,"Checkpoint_Buzz","DLC_AW_Frontend_Sounds",false)end;a.lastDecreased=s end;if a.duration>5 then DrawGTATimerBar("~y~REMAINING TIME~w~",tostring(a.duration),1)else DrawGTATimerBar("~r~REMAINING TIME~w~",tostring(a.duration),1)end;RageUI.Visible(RMenu:Get("selection","mainmenu"),true)local t=PlayerPedId()for h,m in pairs(GetActivePlayers())do local n=GetPlayerPed(m)if n~=0 then SetEntityVisible(n,n==t,false)end end end;Citizen.Wait(0)end end)local function u(i,v)a.lastVehicleName=v;DeleteEntity(a.previewVehicle)a.previewVehicle=CMG.spawnVehicle(i.model,a.position.x,a.position.y,a.position.z,a.heading,false,false,false)FreezeEntityPosition(a.previewVehicle,true)local w=q(a.colourListIndex)SetVehicleColours(a.previewVehicle,w,w)SetVehicleEngineOn(a.previewVehicle,true,true,false)SetPedIntoVehicle(PlayerPedId(),a.previewVehicle,-1)SetVehRadioStation(a.previewVehicle,"OFF")if#(GetEntityCoords(a.previewVehicle)-a.position)>3.0 then SetEntityCoordsNoOffset(a.previewVehicle,a.position.x,a.position.y,a.position.z,true,false,false)end end;local function x(i,v,y)if a.lastVehicleName==nil or a.selectedVehicleName==nil then a.selectedVehicleName=v;a.cbVehicleChanged(v)local w=q(a.colourListIndex)if a.cbColourChanged then a.cbColourChanged(w)end;if y then u(i,v)end end end;local function z(A,B,i,v)if A and v~=a.lastVehicleName then x(i,v,false)u(i,v)end;if B then a.selectedVehicleName=v;AnimpostfxPlay("SuccessNeutral",0,false)PlaySoundFrontend(-1,"Deliver","In_And_Out_Attacker_Sounds",false)a.cbVehicleChanged(v)end;if A and a.cbColourChanged and IsDisabledControlJustPressed(0,22)then if a.colourListIndex==#p then a.colourListIndex=1 else a.colourListIndex=a.colourListIndex+1 end;local w=q(a.colourListIndex)a.cbColourChanged(w)SetVehicleColours(a.previewVehicle,w,w)end end;RMenu.Add("selection","mainmenu",RageUI.CreateMenu("","Select your vehicle",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_minigames_choosevehicle","cmg_minigames_choosevehicle"))RageUI.CreateWhile(1.0,RMenu:Get("selection","mainmenu"),nil,function()RageUI.IsVisible(RMenu:Get("selection","mainmenu"),true,true,true,function()if a.votes and currentEvent.players then RageUI.Separator("Event Options")local C=GetPlayerServerId(PlayerId())for v,D in pairs(a.votes)do RageUI.Checkbox("Vote For "..v,nil,table.has(D,C),{RightLabel=string.format("(%d/%d)",#D,#currentEvent.players)},function()end,function()TriggerServerEvent("CMG:vehicleSelectionSetVote",v,true)end,function()TriggerServerEvent("CMG:vehicleSelectionSetVote",v,false)end)end;RageUI.Separator("Available Vehicles")end;if currentEvent.data.customSpawncode then local v=currentEvent.data.customSpawncode;RageUI.ButtonWithStyle(v,nil,{RightLabel="✔️"},true,function(E,A,B)local i={model=v}z(A,B,i,v)x(i,v,true)end,nil)else for h,F in pairs(a.orders)do for v,i in pairs(a.vehicles)do if i.level==F then local G=v==a.selectedVehicleName and{RightLabel="✔️"}or{}RageUI.ButtonWithStyle(v,nil,G,true,function(E,A,B)z(A,B,i,v)end,nil)x(i,v,true)end end end end end)end)RMenu:Get("selection","mainmenu"):AddInstructionButton({"~INPUT_JUMP~","Switch Colour"})