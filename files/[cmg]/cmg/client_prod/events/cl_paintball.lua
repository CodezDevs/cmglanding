local a=module("cfg/cfg_paintball")local b=nil;local function c(d)local e,f=d[1],d[2]local g=a.arenas[e].teams[f]local h=a.teamConfigs[g.name]drawNativeNotification(string.format("Press ~INPUT_PICKUP~ to play paintball and join the %s%s~w~ team. (£5,000)",h.textFormatColour,string.upper(g.name)))if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballJoin",e,f)end end;Citizen.CreateThread(function()for i,h in pairs(a.teamConfigs)do local j="PAINTBALL_"..string.upper(i)_,relationshipHash=AddRelationshipGroup(j)h.relationship=relationshipHash end;for e,k in pairs(a.arenas)do for f,g in pairs(k.teams)do local l=a.teamConfigs[g.name].markerColour;tvRP.addMarker(g.joinPosition.x,g.joinPosition.y,g.joinPosition.z-0.98,1.0,1.0,1.0,l[1],l[2],l[3],170,50.0,23,false,false,true)CMG.createArea(string.format("paintball_%d_%d_join",e,f),g.joinPosition,1.5,6.0,function()end,function()end,c,{e,f})end end end)local function m()drawNativeNotification("Press ~INPUT_PICKUP~ to submit a vote to start")if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballVoteStart")end end;local function n()drawNativeNotification("Press ~INPUT_PICKUP~ to submit a vote to end")if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballVoteEnd")end end;local function o()drawNativeNotification("Press ~INPUT_PICKUP~ to exit the arena")if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballExit")end end;local function p()drawNativeNotification("~r~Press ~INPUT_PICKUP~ to pick up paintballs!")if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballBuyGun")end end;local function q()drawNativeNotification("~r~Press ~INPUT_PICKUP~ to buy an plasma gun. (£1,000)")if IsControlJustPressed(0,38)then TriggerServerEvent("CMG:paintballBuyPlasma")end end;local function r()local s=RequestScaleformMovie("mp_big_message_freemode")while not HasScaleformMovieLoaded(s)do Citizen.Wait(0)end;local t="~r~"for u,v in pairs(b.info.teams)do if u>1 then t=t.." vs "end;t=t..v.name end;t=t.." - Paintball"BeginScaleformMovieMethod(s,"SHOW_SHARD_WASTED_MP_MESSAGE")ScaleformMovieMethodAddParamTextureNameString(t)ScaleformMovieMethodAddParamTextureNameString("Start the game when everyone is ready by going up to the marker.")EndScaleformMovieMethod()local w=GetGameTimer()while GetGameTimer()-w<5000 and b and not b.isStarted do DrawScaleformMovieFullscreen(s,255,255,255,255,0)Citizen.Wait(0)end;SetScaleformMovieAsNoLongerNeeded(s)end;local function x()for _,y in pairs(a.teamConfigs)do for _,z in pairs(a.teamConfigs)do if y==z then SetRelationshipBetweenGroups(0,y.relationship,z.relationship)else SetRelationshipBetweenGroups(5,y.relationship,z.relationship)end end end;CMG.setFriendlyFire(false)end;local function A()for _,y in pairs(a.teamConfigs)do for _,z in pairs(a.teamConfigs)do if y==z then ClearRelationshipBetweenGroups(0,y.relationship,z.relationship)else ClearRelationshipBetweenGroups(5,y.relationship,z.relationship)end end end;CMG.setFriendlyFire(true)end;local function B()local C=Scaleform("SC_LEADERBOARD")C.RunFunction("SET_DISPLAY_TYPE",{1})C.RunFunction("SET_MULTIPLAYER_TITLE",{b.info.name})C.RunFunction("SET_TITLE",{"NAME","KILLS","DEATHS","KDR"})b.leaderboard=C end;RegisterNetEvent("CMG:paintballJoin",function(e,f)b={info=a.arenas[e],teams={}}for u,g in pairs(b.info.teams)do b.teams[u]={players={},info=g}end;b.team=b.teams[f]local g=b.team.info;b.markers={tvRP.addMarker(b.info.startPosition.x,b.info.startPosition.y,b.info.startPosition.z,1.0,1.0,1.0,0,255,10,170,50.0,5,false,false,true),tvRP.addMarker(b.info.endPosition.x,b.info.endPosition.y,b.info.endPosition.z,1.0,1.0,1.0,255,10,0,170,50.0,24,false,false,true),tvRP.addMarker(b.info.exitPosition.x,b.info.exitPosition.y,b.info.exitPosition.z-1.0,1.0,1.0,1.0,255,255,255,170,50.0,1,false,false,true),tvRP.addMarker(g.buyPaintballPosition.x,g.buyPaintballPosition.y,g.buyPaintballPosition.z,1.0,1.0,1.0,255,255,255,170,50.0,0,false,false,true),tvRP.addMarker(g.buyPlasmaPosition.x,g.buyPlasmaPosition.y,g.buyPlasmaPosition.z,1.0,1.0,1.0,255,255,255,170,50.0,29,false,false,true)}CMG.createArea("paintball_start",b.info.startPosition,1.5,6.0,function()end,function()end,m,nil)CMG.createArea("paintball_end",b.info.endPosition,1.5,6.0,function()end,function()end,n,nil)CMG.createArea("paintball_exit",b.info.exitPosition,1.5,6.0,function()end,function()end,o,nil)CMG.createArea("paintball_buyPaintball",g.buyPaintballPosition,1.5,6.0,function()end,function()end,p,nil)CMG.createArea("paintball_buyPlasma",g.buyPlasmaPosition,1.5,6.0,function()end,function()end,q,nil)Citizen.CreateThread(r)local h=a.teamConfigs[g.name]notify(string.format("You have joined the %s%s~w~ team!",h.textFormatColour,string.upper(g.name)))b.previousCustomisation=tvRP.getCustomization()b.previousWeapons=CMG.getWeapons()tvRP.setCustomization({modelhash=h.modelHash})RemoveAllPedWeapons(PlayerPedId(),false)tvRP.teleport(g.spawnPosition.x,g.spawnPosition.y,g.spawnPosition.z)x()SetPedRelationshipGroupHash(PlayerPedId(),h.relationship)B()end)RegisterNetEvent("CMG:paintballStart",function()b.isStarted=true;b.isRespawning=false;local g=b.team.info;tvRP.teleport(g.spawnPosition.x,g.spawnPosition.y,g.spawnPosition.z)notify("~y~Game starts in ~r~3")Citizen.Wait(1000)notify("~y~Game starts in ~r~2")Citizen.Wait(1000)notify("~y~Game starts in ~r~1")Citizen.Wait(1000)notify("~y~The game has ~r~begun!")local D=PlayerPedId()ClearPedBloodDamage(D)ResetPedVisibleDamage(D)ClearPedLastWeaponDamage(D)Citizen.Wait(2000)drawNativeNotification("Press ~INPUT_VEH_FLY_ATTACK_CAMERA~ to view the leaderboard")end)local function E(F)local G=GetPlayerFromServerId(F)if G==-1 then return end;local D=GetPlayerPed(G)if D==0 then return end;local H=GetBlipFromEntity(D)if H~=0 then RemoveBlip(H)end end;RegisterNetEvent("CMG:paintballEnd",function()b.isEnding=true;tvRP.removeArea("paintball_start")tvRP.removeArea("paintball_end")tvRP.removeArea("paintball_exit")tvRP.removeArea("paintball_buyPaintball")tvRP.removeArea("paintball_buyPlasma")for _,I in pairs(b.markers)do tvRP.removeMarker(I)end;tvRP.setCustomization(b.previousCustomisation,true)Citizen.Wait(500)local w=GetGameTimer()while GetGameTimer()-w<2000 do local D=PlayerPedId()if DoesEntityExist(D)and HaveAllStreamingRequestsCompleted(D)then break end;Citizen.Wait(0)end;RemoveAllPedWeapons(PlayerPedId(),false)Citizen.Wait(0)local D=PlayerPedId()ClearPedBloodDamage(D)ResetPedVisibleDamage(D)ClearPedLastWeaponDamage(D)tvRP.teleport(b.info.homePosition.x,b.info.homePosition.y,b.info.homePosition.z)for F in pairs(b.team.players)do E(F)end;A()SetPedRelationshipGroupHash(PlayerPedId(),`PLAYER`)CMG.giveWeapons(b.previousWeapons,true)b=nil end)RegisterNetEvent("CMG:paintballFullSyncTeam",function(f,J)b.teams[f].players=J end)RegisterNetEvent("CMG:paintballPlayerJoin",function(f,F,K)b.teams[f].players[F]=K end)RegisterNetEvent("CMG:paintballPlayerLeave",function(F)for _,v in pairs(b.teams)do if v.players[F]then v.players[F]=nil;break end end;E(F)end)RegisterNetEvent("CMG:paintballSetPlayerKillsDeaths",function(F,L,M)for _,v in pairs(b.teams)do local K=v.players[F]if K then K.kills=L;K.deaths=M;break end end end)function CMG.isInPaintball()return b~=nil end;local function N()if not b then return end;local O=PlayerId()for F in pairs(b.team.players)do local G=GetPlayerFromServerId(F)if G~=-1 and G~=O then local D=GetPlayerPed(G)if D~=0 and GetBlipFromEntity(D)==0 then local h=a.teamConfigs[b.team.info.name]local P=AddBlipForEntity(D)SetBlipColour(P,h.blipColour)ShowHeadingIndicatorOnBlip(P,true)end end end;local Q=CMG.getPlayerCoords()local R=#(b.info.boundCenter-Q)if R>b.info.boundRadius and not b.isEnding then local g=b.team.info;tvRP.teleport(g.spawnPosition.x,g.spawnPosition.y,g.spawnPosition.z)end;if b.leaderboard then if IsControlPressed(0,121)then local S={}for _,v in pairs(b.teams)do local h=a.teamConfigs[v.info.name]for _,K in pairs(v.players)do local T=h.textFormatColour..string.upper(K.name)local U=K.deaths==0 and 1 or K.deaths;local V=tostring(math.floor(K.kills/U*100)/100)table.insert(S,{T,K.kills,K.deaths,V})end end;table.sort(S,function(W,X)return W[2]>X[2]end)for u,Y in pairs(S)do b.leaderboard.RunFunction("SET_SLOT",{u-1,1,Y[1],"","",Y[2],Y[3],Y[4]})end;b.leaderboard.Render2D()end end;local D=PlayerPedId()local Z=GetEntityHealth(D)if Z>102 then return end;if not b.lastDied then b.lastDied=GetGameTimer()elseif GetGameTimer()-b.lastDied>1000 then TriggerEvent("CMG:Revive")local g=b.team.info;tvRP.teleport(g.spawnPosition.x,g.spawnPosition.y,g.spawnPosition.z)b.lastDied=nil end end;CMG.createThreadOnTick(N)local function a0(a1)local w=GetGameTimer()while GetGameTimer()-w<a1 do SetLocalPlayerAsGhost(true)Citizen.Wait(0)end end;local function a2()Citizen.Wait(1000)DoScreenFadeOut(500)Citizen.Wait(500)if not b then DoScreenFadeIn(0)return end;local g=b.team.info;tvRP.teleport(g.spawnPosition.x,g.spawnPosition.y,g.spawnPosition.z)local D=PlayerPedId()CMG.setStunExitsEarly()ClearEntityLastDamageEntity(D)ClearEntityLastWeaponDamage(D)ClearPedLastWeaponDamage(D)ClearPedTasksImmediately(D)a0(3500)SetLocalPlayerAsGhost(false)if b then b.isRespawning=false end end;AddEventHandler("entityDamaged",function(a3,a4,a5,a6)if b and b.isStarted and not b.isRespawning and(a5==`WEAPON_PAINTBALL`or a5==`WEAPON_PLASMAP`)then if a3==PlayerPedId()and IsEntityAPed(a4)and IsPedAPlayer(a4)then local a7=NetworkGetPlayerIndexFromPed(a4)local a8=GetPlayerServerId(a7)if a8>0 then TriggerServerEvent("CMG:paintballDiedToPlayer",a8)b.isRespawning=true;a2()end end end end)