DecorRegister("vRP_owner",3)DecorRegister("vRP_vmodel",3)DecorRegister("lootid",3)DecorRegister("lsAudioId",3)RequestScriptAudioBank("DLC_ALARM\\ALARMPACK_ONE",false)local a=module("cfg/vehicles/garages")local b=module("cfg/cfg_lscustoms")local c=a.garages;globalVehicleModelHashMapping={}globalVehicleOwnership={}globalOwnedPlayerVehicles={}globalLastSpawnedVehicleTime=0;local d={}local e=0;local f=""local g=""local h=""local j=""local k={}local l=0;local m=0;local n={}local o=false;local p={}local q={}local r={}local s={}local t={}local u=false;local v=false;local w={[0]="",[1]="",[2]="",[3]="",[4]="",[5]="",[6]="bnr34ffeng",[7]="ta028viper",[8]="rotary7",[9]="lgcy12ferf40",[10]="v6audiea839",[11]="n55b30t0",[12]="fordvoodoo",[13]="ta103ninjah2r"}local x={}AddEventHandler("CMG:onClientSpawn",function(y,z)if z then TriggerServerEvent("CMG:refreshGaragePermissions")end end)RegisterNetEvent("CMG:recieveRefreshedGaragePermissions",function(A)d=A end)RegisterNetEvent("CMG:initRentingVehicles",function(B)p=B end)RegisterNetEvent("CMG:initRentedVehicles",function(C)q=C end)RegisterNetEvent("CMG:insertRentedVehicles",function(D)table.insert(q,D)end)RegisterNetEvent("CMG:insertRentingVehicles",function(E)table.insert(p,E)end)RegisterNetEvent("CMG:setVehicleRarity",function(F,G)x[F]=G end)RegisterNetEvent("CMG:decreaseHourRentedVehicles",function(F)for H,I in pairs(q)do if string.lower(I.vehicleId)==string.lower(F)then if q[H].hoursLeft>1 then q[H].hoursLeft=q[H].hoursLeft-1 else q[H]=nil end end end end)RegisterNetEvent("CMG:decreaseHourRentingVehicles",function(F)for H,I in pairs(p)do if string.lower(I.vehicleId)==string.lower(F)then if p[H].hoursLeft>1 then p[H].hoursLeft=p[H].hoursLeft-1 else p[H]=nil end end end end)RegisterNetEvent("CMG:endRentedVehicle",function(F)for H,I in pairs(q)do if string.lower(I.vehicleId)==string.lower(F)then q[H]=nil end end end)RegisterNetEvent("CMG:endRentingVehicle",function(F)for H,I in pairs(p)do if string.lower(I.vehicleId)==string.lower(F)then p[H]=nil end end end)RegisterNetEvent("CMG:updateOwnedVehicles",function(J,K)r=K;globalOwnedPlayerVehicles={}globalOwnedPlayerVehicles=J;for L,M in pairs(c)do for N,O in pairs(M)do if N~="_config"then c[L][N][4]=false end end end;for L,M in pairs(c)do for N,O in pairs(M)do if N~="_config"then for H,I in pairs(globalOwnedPlayerVehicles)do if string.lower(N)==string.lower(H)then c[L][N][4]=true end end end end end;s=CMG.getCustomFolders()for P,Q in pairs(s)do for F,R in pairs(Q)do if globalOwnedPlayerVehicles[string.lower(F)]then s[P][F][4]=true else s[P][F][4]=false end end end;t=CMG.getGarageSettings()local S={}for L,M in pairs(c)do for N,O in pairs(M)do if N~="_config"then if c[L][N][4]then if not S[#S]or S[#S].display~=L then table.insert(S,{display=L,vehicles={}})end;if L=="VIP Cars"or L=="Standard Garage"or L=="MET Police Vehicles"or L=="NHS Vehicles"or L=="LFB Garage"or L=="AA"or L=="Rebel Garage"or L=="Diamond Casino"or L=="SOA Vehicles"or L=="CMG Trader Vehicles"or L=="HMP Vehicles"then table.insert(S[#S].vehicles,{display=O[1],spawncode=N})end end end end end;table.sort(S,function(T,U)return T.display<U.display end)for V,W in pairs(S)do table.sort(W.vehicles,function(T,U)return T.display<U.display end)end;TriggerEvent("CMG:setVehicleFolders",S)end)RegisterCommand("resendvalet",function()local S={}print("init resendvalet()")for L,M in pairs(c)do for N,O in pairs(M)do if N~="_config"then if c[L][N][4]then if not S[#S]or S[#S].display~=L then print("init",L)table.insert(S,{display=L,vehicles={}})end;if L=="VIP Cars"or L=="Standard Garage"or L=="MET Police Vehicles"or L=="NHS Vehicles"or L=="LFB Garage"or L=="AA"or L=="Rebel Garage"or L=="Diamond Casino"or L=="SOA Vehicles"or L=="CMG Trader Vehicles"or L=="HMP Vehicles"then print("inserting",N)print("to",S[#S])table.insert(S[#S].vehicles,{display=O[1],spawncode=N})end end end end end;print("unsorted valetTable",dump(S))table.sort(S,function(T,U)return T.display<U.display end)for V,W in pairs(S)do table.sort(W.vehicles,function(T,U)return T.display<U.display end)end;print("sorted valetTable",dump(S))TriggerEvent("CMG:setVehicleFolders",S)end)local function X(L)if d[L]then return true else return false end end;local function Y(L)RageUI.CloseAll()if X(L)then RageUI.Visible(RMenu:Get('garages','mainmenu'),true)end end;local function Z(L)RageUI.CloseAll()RageUI.Visible(RMenu:Get('garages','mainmenu'),false)end;CreateThread(function()local _={}local a0={}for L,I in pairs(a.garages)do for N,O in pairs(I)do if N=="_config"then local a1,a2,a3,a4,a5,type=O.blipid,O.blipcolor,O.markerid,O.markercolours,O.permissions,O.type;for a6,a7 in pairs(a.garageInstances)do local a8,a9,aa=table.unpack(a7)if L==a8 then if aa then table.insert(_,{position=a9,blipId=a1,blipColor=a2,name=a8})end;table.insert(a0,{position=a9,colour=a4,markerId=a3})end end end end end;local ab=function(ac)PlaySound(-1,"Hit","RESPAWN_SOUNDSET",0,0,1)j=c[ac.garageType]["_config"].type;Y(ac.garageType)selectedGarageVector=ac.position end;local ad=function(ac)PlaySound(-1,"Hit","RESPAWN_SOUNDSET",0,0,1)Z(ac.garageType)end;local ae=function(ac)end;for af,ag in pairs(a.garageInstances)do CMG.createArea("garage_"..af,ag[2],1.5,6,ab,ad,ae,{garageType=ag[1],garageId=af,position=ag[2]})end;for a1,ah in pairs(_)do tvRP.addBlip(ah.position.x,ah.position.y,ah.position.z,ah.blipId,ah.blipColor,ah.name,0.7,false)end;for a3,ai in pairs(a0)do tvRP.addMarker(ai.position.x,ai.position.y,ai.position.z,0.7,0.7,0.5,ai.colour[1],ai.colour[2],ai.colour[3],125,50,ai.markerId,true)end end)local aj=0;local ak=0.0;local function al(F)DeleteVehicle(GetVehiclePedIsIn(CMG.getPlayerPed(),false))CreateThread(function()local am=GetHashKey(F)RequestModel(am)local an=0;while not HasModelLoaded(am)and an<200 do drawNativeText("~r~Downloading vehicle model")Wait(0)an=an+1 end;if HasModelLoaded(am)then local ao=CreateVehicle(am,selectedGarageVector.x,selectedGarageVector.y,selectedGarageVector.z,ak,false,false)DecorSetInt(ao,"CMGACVeh",955)SetEntityAsMissionEntity(ao)FreezeEntityPosition(ao,true)SetEntityInvincible(ao,true)SetVehicleDoorsLocked(ao,4)SetModelAsNoLongerNeeded(am)if aj~=0 then DestroyCam(aj,0)aj=0 end;SetEntityAlpha(CMG.getPlayerPed(),0)FreezeEntityPosition(CMG.getPlayerPed(),true)SetEntityCollision(CMG.getPlayerPed(),false,false)SetEntityCollision(ao,false,false)local ap=GetEntityCoords(CMG.getPlayerPed())local aq=GetEntityRotation(CMG.getPlayerPed())local ar=CreateCam("DEFAULT_SCRIPTED_CAMERA",1)local as=vector3(ap.x,ap.y,ap.z+2.0)-GetEntityForwardVector(CMG.getPlayerPed())*4.0;SetCamActive(ar,true)RenderScriptCams(true,true,500,1,0)SetCamCoord(ar,as)SetCamRot(ar,-20.0,aq.y,aq.z)aj=ar;Citizen.CreateThread(function()while DoesEntityExist(ao)do Citizen.Wait(25)ak=(ak+1)%360;SetEntityHeading(ao,ak)end end)u=false;o=true;l=ao else tvRP.notify("~r~Failed to load vehicle.")return-1 end end)end;local function at(au)local av=AddBlipForEntity(au)SetBlipSprite(av,56)SetBlipDisplay(av,4)SetBlipScale(av,1.0)SetBlipColour(av,2)SetBlipAsShortRange(av,true)end;RegisterNetEvent("CMG:spawnPersonalVehicle",function(F,aw,ax,ay,az)Z()if GetVehiclePedIsIn(CMG.getPlayerPed(),false)==e then DeleteEntity(e)end;tvRP.notify("~g~Loading vehicle, please wait.")local aA=globalVehicleOwnership[F]if aA==nil or not DoesEntityExist(aA[2])then local am=CMG.loadModel(F)if am==nil then tvRP.notify("~r~Vehicle does not exist, if you believe this is an error contact a Car Dev on discord.")return end;globalVehicleModelHashMapping[am]=F;globalLastSpawnedVehicleTime=GetGameTimer()local au;if ay then local ap=CMG.getPosition()local aB,V,aC=GetNthClosestVehicleNode(ap.x,ap.y,ap.z,nil,8,8,8,8)local V,aD,V=GetNthClosestVehicleNode(ap.x,ap.y,ap.z,15)local aE,V,aF=GetClosestVehicleNodeWithHeading(ap.x,ap.y,ap.z,nil,8,8,8,8)local V,aG,V=GetPointOnRoadSide(ap.x,ap.y,ap.z,0.0)if tostring(aG)~="vector3(0, 0, 0)"and tostring(aD)~="vector3(0, 0, 0)"then au=CMG.spawnVehicle(am,aD.x,aD.y,aD.z+0.5,aC or 0.0,false,true,true)CMG.loadModel(`s_m_y_xmech_01`)SendNUIMessage({transactionType="MPCT_AKAA_0"..math.random(1,5)})local aH=CreatePedInsideVehicle(au,"PED_TYPE_CIVMALE",`s_m_y_xmech_01`,-1,false,false)SetModelAsNoLongerNeeded(`s_m_y_xmech_01`)TaskVehicleDriveToCoord(aH,au,aG.x,aG.y,aG.z,15.0,1.0,am,786603,5.0)at(au)SetTimeout(5000,function()while GetEntitySpeed(au)>5.0 do Wait(500)end;TaskLeaveVehicle(aH,au,64)TaskWanderStandard(aH,10.0,10)Wait(10000)DeletePed(aH)end)print("[CMG] Spawned vehicle with spawncode:"..tostring(F))DecorSetInt(au,"vRP_owner",CMG.getUserId())DecorSetInt(au,"vRP_vmodel",F)globalVehicleOwnership[F]={F,au}setVehicleFuel(au,r[F])while CMG.getPlayerVehicle()~=au do Wait(100)end;tvRP.applyModsOnVehicle(aw,F,au)TriggerServerEvent("CMG:spawnVehicleCallback",ax,VehToNet(au))table.insert(n,au)end else local aI=az or CMG.getPosition()au=CMG.spawnVehicle(am,aI.x,aI.y,aI.z+0.5,GetEntityHeading(PlayerPedId()),true,true,true)at(au)print("[CMG] Spawned vehicle with spawncode:"..tostring(F))DecorSetInt(au,"vRP_owner",CMG.getUserId())DecorSetInt(au,"vRP_vmodel",F)globalVehicleOwnership[F]={F,au}setVehicleFuel(au,r[F])tvRP.applyModsOnVehicle(aw,F,au)TriggerServerEvent("CMG:spawnVehicleCallback",ax,VehToNet(au))table.insert(n,au)CreateThread(function()local aJ=true;SetTimeout(5000,function()aJ=false end)while aJ do if DoesEntityExist(au)then SetLocalPlayerAsGhost(true)SetNetworkVehicleAsGhost(au,true)SetEntityAlpha(au,220)end;Wait(0)end;SetLocalPlayerAsGhost(false)SetNetworkVehicleAsGhost(au,false)SetEntityAlpha(au,255)ResetEntityAlpha(au)end)end;SetModelAsNoLongerNeeded(am)while DoesEntityExist(au)do local aK=CMG.getVehicleFuel(au)if r[F]~=aK then TriggerServerEvent("CMG:updateFuel",F,math.floor(aK*1000)/1000)r[F]=aK;SetEntityInvincible(au,false)SetEntityCanBeDamaged(au,true)end;Wait(60000)end else tvRP.notify("This vehicle is already out.")end end)function func_previewGarageVehicle()if o then if IsControlJustPressed(0,177)then DeleteVehicle(l)l=0;m=0;o=false;DestroyCam(aj,0)RenderScriptCams(0,0,1,1,1)aj=0;SetFocusEntity(GetPlayerPed(PlayerId()))SetEntityAlpha(CMG.getPlayerPed(),255)FreezeEntityPosition(CMG.getPlayerPed(),false)SetEntityCollision(CMG.getPlayerPed(),true,true)end end end;CMG.createThreadOnTick(func_previewGarageVehicle)local function aL(F)return F=="surprise"end;local function aM(F)for L,aN in pairs(c)do for aO in pairs(aN)do if aO~="_config"and aO==F then return X(L)and j==aN["_config"].type end end end;return true end;RMenu.Add('garages','mainmenu',RageUI.CreateMenu("","",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_garageui","cmg_garageui"))RMenu:Get('garages','mainmenu'):SetSubtitle("~b~Garages")RMenu.Add('garages','rentmanager',RageUI.CreateSubMenu(RMenu:Get('garages','mainmenu'),"","~b~Rent Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','rentedout',RageUI.CreateSubMenu(RMenu:Get('garages','rentmanager'),"","~b~Vehicles Rented Out",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','rentedin',RageUI.CreateSubMenu(RMenu:Get('garages','rentmanager'),"","~b~Vehicles Renting",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','rentedinfo',RageUI.CreateSubMenu(RMenu:Get('garages','rentedin'),"","~b~Vehicles Rent Info",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','listgarages',RageUI.CreateSubMenu(RMenu:Get('garages','mainmenu'),"","~b~Garage Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','vehiclemenu',RageUI.CreateSubMenu(RMenu:Get('garages','listgarages'),"","~b~Vehicle Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','spawnmenu',RageUI.CreateSubMenu(RMenu:Get('garages','vehiclemenu'),"","~b~Spawn Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','customfolders',RageUI.CreateSubMenu(RMenu:Get('garages','listgarages'),"","~b~Custom Folders Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('garages','settings',RageUI.CreateSubMenu(RMenu:Get('garages','mainmenu'),"","~b~Settings",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add("garages","confirm",RageUI.CreateMenu("","",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_garageui","cmg_garageui"))RMenu:Get("garages","confirm"):SetSubtitle("~b~Are you sure you want to DELETE this vehicle?")local function aP()RageUI.ButtonWithStyle("[Create Custom Folder]","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local P=getCustomFolderNameInput()if P~=""then if s[P]==nil then CMG.createCustomFolder(P)else tvRP.notify("~r~Folder already exists.")end else tvRP.notify("~r~Invalid folder name.")end end end,RMenu:Get('garages','customfolders'))RageUI.ButtonWithStyle("[Delete Custom Folder]","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local P=getCustomFolderNameInput()if P~=""then if s[P]then CMG.deleteCustomFolder(P)else tvRP.notify("~r~Folder already exists.")end else tvRP.notify("~r~Invalid folder name.")end end end,RMenu:Get('garages','customfolders'))for P,Q in pairs(s)do RageUI.ButtonWithStyle(P,"",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then h=nil;selectedCustomFolder=P end end,RMenu:Get('garages','vehiclemenu'))end end;RageUI.CreateWhile(1.0,RMenu:Get('garages','mainmenu'),nil,function()RageUI.IsVisible(RMenu:Get('garages','mainmenu'),true,true,true,function()RageUI.ButtonWithStyle("Garages",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','listgarages'))RageUI.ButtonWithStyle("Store Vehicle",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local aT=GetVehiclePedIsIn(CMG.getPlayerPed(),false)if DoesEntityExist(aT)then DeleteEntity(aT)end end end,RMenu:Get('garages','mainmenu'))RageUI.ButtonWithStyle("Rent Manager",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','rentmanager'))RageUI.ButtonWithStyle("Settings","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','settings'))RageUI.ButtonWithStyle("~y~Fuel all vehicles. (£25,000)",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then if CMG.isPlusClub()or CMG.isPlatClub()then if not v then TriggerServerEvent("CMG:fuelAllVehicles")v=true;SendNUIMessage({transactionType="playMoney"})SetTimeout(60000,function()v=false end)else tvRP.notify("~r~You've done this too recently, try again later.")end else tvRP.notify("~y~You need to be a subscriber of CMG Plus or CMG Platinum to use this feature.")tvRP.notify("~y~Available @ store.cmgstudios.net")end end end)end,function()end)RageUI.IsVisible(RMenu:Get('garages','rentmanager'),true,true,true,function()RageUI.ButtonWithStyle("Vehicles Rented Out",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','rentedout'))RageUI.ButtonWithStyle("Vehicles Rented In",g,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','rentedin'))end,function()end)RageUI.IsVisible(RMenu:Get('garages','rentedout'),true,true,true,function()for V,aU in pairs(q)do local aV,aW,aX=aU.vehicleName,aU.rentedBy,aU.hoursLeft;RageUI.ButtonWithStyle(aV,"Rented to "..aW.." - "..aX.." hours left!",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then k=aU;k.type="rentingout"end end,RMenu:Get('garages','rentedinfo'))end end,function()end)RageUI.IsVisible(RMenu:Get('garages','rentedin'),true,true,true,function()for V,aU in pairs(p)do local aV,aW,aX=aU.vehicleName,aU.rentedBy,aU.hoursLeft;RageUI.ButtonWithStyle(aV,"Rented from "..aW.." - "..aX.." hours left!",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then k=aU;k.type="rentingin"end end,RMenu:Get('garages','rentedinfo'))end end,function()end)RageUI.IsVisible(RMenu:Get('garages','rentedinfo'),true,true,true,function()local F,aV,aW,aX=k.vehicleId,k.vehicleName,k.rentedBy,k.hoursLeft;RageUI.Separator("~y~Rent Info")RageUI.Separator("---------")RageUI.Separator("Vehicle: "..aV)RageUI.Separator("Rented from: "..aW)RageUI.Separator("Hours Left: "..aX)RageUI.ButtonWithStyle("Request Rent Cancellation","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then TriggerServerEvent("CMG:requestRentCancellation",aV,F,k.type)end end)end,function()end)RageUI.IsVisible(RMenu:Get('garages','listgarages'),true,true,true,function()if not t.showCustomFoldersInGarageMenu then RageUI.ButtonWithStyle("[Custom Folders]","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','customfolders'))else aP()end;local aY=sortAlphabetically(c)for V,M in pairs(aY)do local L=M.title;local O=M["value"]["_config"]local a1,a2,a3,a4,a5,aZ=O.blipid,O.blipcolor,O.markerid,O.markercolours,O.permissions,O.type;if X(L)and j==aZ then RageUI.ButtonWithStyle(L,"",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then h=L;selectedCustomFolder=nil end end,RMenu:Get('garages','vehiclemenu'))end end end,function()end)RageUI.IsVisible(RMenu:Get('garages','customfolders'),true,true,true,function()aP()end,function()end)RageUI.IsVisible(RMenu:Get('garages','spawnmenu'),true,true,true,function()local a_=g;if x[f]then a_=a_.." | ".."Rarity (1:"..tostring(x[f])..")"end;RageUI.ButtonWithStyle("Spawn Vehicle",a_,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then for H,I in pairs(n)do if not DoesEntityExist(I)then table.remove(n,H)end end;if#n<=5 then DeleteVehicle(l)l=0;m=0;o=false;DestroyCam(aj,0)RenderScriptCams(0,0,1,1,1)aj=0;SetFocusEntity(GetPlayerPed(PlayerId()))SetEntityAlpha(CMG.getPlayerPed(),255)FreezeEntityPosition(CMG.getPlayerPed(),false)SetEntityCollision(CMG.getPlayerPed(),true,true)local aA=globalVehicleOwnership[f]if aA==nil or not DoesEntityExist(aA[2])then TriggerServerEvent("CMG:spawnPersonalVehicle",f)else tvRP.notify("Vehicle is already out!")end else tvRP.notify("~r~You may only take out a maximum of 5 vehicles at a time.")end end end)RageUI.ButtonWithStyle("Sell Vehicle to Player",a_,{RightLabel="→→→"},CMG.canVehicleBeSold(f),function(aQ,aR,aS)if aQ then end;if aR then end;if aS and CMG.canVehicleBeSold(f)then TriggerServerEvent("CMG:beginSellVehicleToPlayer",f)end end,RMenu:Get('garages','spawnmenu'))RageUI.ButtonWithStyle("Rent Vehicle to Player",a_,{RightLabel="→→→"},CMG.canVehicleBeRented(f),function(aQ,aR,aS)if aQ then end;if aR then end;if aS and CMG.canVehicleBeRented(f)then TriggerServerEvent("CMG:beginRentVehicleToPlayer",f)end end,RMenu:Get('garages','spawnmenu'))RageUI.ButtonWithStyle("Crush Vehicle","This will ~r~DELETE ~w~this vehicle from your garage!",{RightLabel="→→→"},CMG.canVehicleBeSold(f),function(aQ,aR,aS)if aQ then end;if aR then end;if aS then end end,RMenu:Get('garages','confirm'))RageUI.ButtonWithStyle("Add to custom folder",a_,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local P=getCustomFolderNameInput()CMG.addCarToCustomFolder(f,g,P)end end,RMenu:Get('garages','spawnmenu'))RageUI.ButtonWithStyle("Remove from custom folder",a_,{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local P=getCustomFolderNameInput()CMG.removeCarFromCustomFolder(f,P)end end,RMenu:Get('garages','spawnmenu'))RageUI.ButtonWithStyle("View Remote Dashcam",a_,{RightLabel="→→→"},true,function(aQ,aR,aS)if aS then TriggerServerEvent("CMG:viewRemoteDashcam",f)end end)RageUI.ButtonWithStyle("Display Vehicle Blip",a_,{RightLabel="→→→"},true,function(aQ,aR,aS)if aS then TriggerServerEvent("CMG:displayVehicleBlip",f)end end)end,function()end)RageUI.IsVisible(RMenu:Get('garages','vehiclemenu'),true,true,true,function()for L,M in pairs(c)do if L==h then selectedCustomFolder=nil;local b0={}for F,R in pairs(M)do table.insert(b0,{vehicleId=F,vehicleName=R[1]or"z",playerOwned=R[4]})end;table.sort(b0,function(T,U)return T.vehicleName<U.vehicleName end)for V,M in pairs(b0)do local F=M.vehicleId;local aV=M.vehicleName;local b1=M.playerOwned;if F~="_config"then if t.hideCustomFolderVehiclesFromOriginalGarages and CMG.isVehicleInAnyCustomFolder(F)or aL(F)and CMG.getStaffLevel()==0 then else if b1 then local b2=math.floor((r[F]or 0)*1000)/1000;local b3=""if b2<=20 then b3="~r~"elseif b2<=50 then b3="~y~"elseif b2<=100 then b3="~g~"end;if CMG.isVehicleImpounded(F)then aV=aV.." ~r~(IMPOUNDED)"end;RageUI.ButtonWithStyle(aV,b3 .."Fuel "..tostring(b2).."%",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then if(l==0 or m~=F)and not u then DeleteVehicle(l)u=true;al(F)m=F end end;if aS then f=F;TriggerServerEvent("CMG:getVehicleRarity",F)g=aV;selectedCustomFolder=nil end end,RMenu:Get('garages','spawnmenu'))end end end end end end;local b4=s[selectedCustomFolder]if b4 then local b0={}for F,R in pairs(b4)do if aM(F)then table.insert(b0,{vehicleId=F,vehicleName=R[1]or"z",playerOwned=R[4]})end end;table.sort(b0,function(T,U)return T.vehicleName<U.vehicleName end)for V,M in pairs(b0)do local F=M.vehicleId;local aV=M.vehicleName;local b1=M.playerOwned;if F~="_config"then if b1 then local b2=math.floor((r[F]or 0)*1000)/1000;local b3=""if b2<=20 then b3="~r~"elseif b2<=50 then b3="~y~"elseif b2<=100 then b3="~g~"end;if CMG.isVehicleImpounded(F)then aV=aV.." ~r~(IMPOUNDED)"end;if aL(F)and CMG.getStaffLevel()==0 then else RageUI.ButtonWithStyle(aV,b3 .."Fuel "..tostring(b2).."%",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then if(l==0 or m~=F)and not u then DeleteVehicle(l)u=true;al(F)m=F end end;if aS then f=F;g=aV;TriggerServerEvent("CMG:getVehicleRarity",F)end end,RMenu:Get('garages','spawnmenu'))end end end end end end,function()end)RageUI.IsVisible(RMenu:Get('garages','confirm'),true,true,true,function()RageUI.ButtonWithStyle("No","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then tvRP.notify("~y~Cancelled!")end end,RMenu:Get('garages','spawnmenu'))RageUI.ButtonWithStyle("Yes","",{RightLabel="→→→"},true,function(aQ,aR,aS)if aQ then end;if aR then end;if aS then local aT=GetVehiclePedIsIn(CMG.getPlayerPed(),false)if DoesEntityExist(aT)then DeleteEntity(aT)end;if verifyCrushVehicle()=="CONFIRM"then TriggerServerEvent("CMG:crushVehicle",f)else tvRP.notify("~r~Cancelled vehicle crush!")end end end,RMenu:Get('garages','spawnmenu'))end,function()end)RageUI.IsVisible(RMenu:Get('garages','settings'),true,true,true,function()RageUI.Checkbox("Hide custom folder vehicles","This hides these vehicles from their original garage.",t.hideCustomFolderVehiclesFromOriginalGarages,{},function(aQ,aS,aR,b5)end,function()t.hideCustomFolderVehiclesFromOriginalGarages=true;CMG.saveGarageSettings()end,function()t.hideCustomFolderVehiclesFromOriginalGarages=false;CMG.saveGarageSettings()end)RageUI.Checkbox("Show Custom Folders In Garage Menu","~y~This removes the [Custom Folders] menu item, and puts custom folders in the root garages menu.",t.showCustomFoldersInGarageMenu,{},function(aQ,aS,aR,b5)end,function()t.showCustomFoldersInGarageMenu=true;CMG.saveGarageSettings()end,function()t.showCustomFoldersInGarageMenu=false;CMG.saveGarageSettings()end)end,function()end)end)function verifyCrushVehicle()AddTextEntry('FMMC_MPM_NA',"Please type CONFIRM in all caps to confirm the crushing of this vehicle?")DisplayOnscreenKeyboard(1,"FMMC_MPM_NA","Please type CONFIRM in all caps to confirm the crushing of this vehicle","","","","",30)while UpdateOnscreenKeyboard()==0 do DisableAllControlActions(0)Wait(0)end;if GetOnscreenKeyboardResult()then local b6=GetOnscreenKeyboardResult()if b6 then return b6 else return""end end;return""end;function getCustomFolderNameInput()AddTextEntry('FMMC_MPM_NA',"Enter folder name:")DisplayOnscreenKeyboard(1,"FMMC_MPM_NA","Enter folder name:","","","","",30)while UpdateOnscreenKeyboard()==0 do DisableAllControlActions(0)Wait(0)end;if GetOnscreenKeyboardResult()then local b6=GetOnscreenKeyboardResult()if b6 then return b6 else return""end end;return""end;function tvRP.getVehicleInfos(ao)if ao and DecorExistOn(ao,"vRP_owner")and DecorExistOn(ao,"vRP_vmodel")then local y=DecorGetInt(ao,"vRP_owner")local b7=DecorGetInt(ao,"vRP_vmodel")local b8=globalVehicleModelHashMapping[GetEntityModel(ao)]if b8 then return y,b8 end end end;function tvRP.getNetworkedVehicleInfos(b9)local ao=NetToVeh(b9)if ao and DecorExistOn(ao,"vRP_owner")and DecorExistOn(ao,"vRP_vmodel")then local y=DecorGetInt(ao,"vRP_owner")local b7=DecorGetInt(ao,"vRP_vmodel")local b8=globalVehicleModelHashMapping[GetEntityModel(ao)]if b8 then return y,b8 end end end;function stringsplit(ba,bb)if bb==nil then bb="%s"end;local bc={}i=1;for bd in string.gmatch(ba,"([^"..bb.."]+)")do bc[i]=bd;i=i+1 end;return bc end;local function be(bf,bg,currentVehicle)for i=0,GetNumModColors(bf,false)-1 do SetVehicleModColor_1(currentVehicle,bf,i,0)if GetVehicleColours(currentVehicle)==bg then return end end;local V,bh=GetVehicleColours(currentVehicle)SetVehicleColours(currentVehicle,bg,bh)end;local function bi(bf,bg,currentVehicle)for i=0,GetNumModColors(bf,false)-1 do SetVehicleModColor_2(currentVehicle,bf,i)local V,bh=GetVehicleColours(currentVehicle)if bh==bg then return end end;SetVehicleColours(currentVehicle,GetVehicleColours(currentVehicle),bg)end;function applyPrimaryColours(aw,bj)local bk=0;for H,I in pairs(aw["chrome"])do if I==true then be(5,tonumber(H),bj)end end;for H,I in pairs(aw["classic"])do if I==true then be(0,tonumber(H),bj)end end;for H,I in pairs(aw["matte"])do if I==true then be(3,tonumber(H),bj)end end;for H,I in pairs(aw["metals"])do if I==true then be(4,tonumber(H),bj)end end;for H,I in pairs(aw["metallic"])do if I==true then be(1,tonumber(H),bj)end end;for H,I in pairs(aw["util"])do if I==true then bk=tonumber(H)end end;for H,I in pairs(aw["chameleon"])do if I==true then bk=tonumber(H)end end;if bk~=0 then local V,bl=GetVehicleColours(bj)SetVehicleColours(bj,bk,bl)end end;function applySecondaryColours(aw,bj)local bm=0;for H,I in pairs(aw["chrome2"])do if I==true then bi(5,tonumber(H),bj)end end;for H,I in pairs(aw["classic2"])do if I==true then bi(0,tonumber(H),bj)end end;for H,I in pairs(aw["matte2"])do if I==true then bi(3,tonumber(H),bj)end end;for H,I in pairs(aw["metal2"])do if I==true then bi(4,tonumber(H),bj)end end;for H,I in pairs(aw["metallic2"])do if I==true then bi(1,tonumber(H),bj)end end;if bm~=0 then local bn=GetVehicleColours(bj)SetVehicleColours(bj,bn,bm)end end;function tvRP.applyModsOnVehicle(aw,F,bj)for H,I in pairs(aw["windowtint"])do if I==true then SetVehicleWindowTint(bj,tonumber(H))end end;Wait(0)SetVehicleModKit(bj,0)for H,I in pairs(aw.sportwheels)do if I==true then SetVehicleWheelType(bj,0)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw.musclewheels)do if I==true then SetVehicleWheelType(bj,1)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["lowriderwheels"])do if I==true then SetVehicleWheelType(bj,2)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["highendwheels"])do if I==true then SetVehicleWheelType(bj,7)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["suvwheels"])do if I==true then SetVehicleWheelType(bj,3)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["offroadwheels"])do if I==true then SetVehicleWheelType(bj,4)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["tunerwheels"])do if I==true then SetVehicleWheelType(bj,6)SetVehicleMod(bj,23,tonumber(H))end end;Wait(0)for H,I in pairs(aw["wheelaccessories"])do if I==true then SetVehicleModKit(bj,0)ToggleVehicleMod(bj,20,true)H=H:gsub("%[","")H=H:gsub("]","")smokecolor=stringsplit(H,",")SetVehicleTyreSmokeColor(bj,tonumber(smokecolor[1]),tonumber(smokecolor[2]),tonumber(smokecolor[3]))end end;Wait(0)applyPrimaryColours(aw,bj)Wait(0)applySecondaryColours(aw,bj)for H,I in pairs(aw["pearlescent"])do if I==true then local V,bo=GetVehicleExtraColours(bj)SetVehicleExtraColours(bj,tonumber(H),bo)end end;for H,I in pairs(aw["wheelcolor"])do if I==true then SetVehicleExtraColours(bj,GetVehicleExtraColours(bj),tonumber(H))end end;local bp=0;for H,I in pairs(aw["interiorcolour"])do if I==true then bp=tonumber(H)end end;SetVehicleInteriorColor(bj,bp)local bq=0;for H,I in pairs(aw["dashboardcolour"])do if I==true then bq=tonumber(H)end end;SetVehicleDashboardColor(bj,bq)local bj=GetVehiclePedIsIn(CMG.getPlayerPed())SetVehicleModKit(bj,0)for i=0,48,1 do if aw[tostring("mod_"..i)]~=nil then for H,I in pairs(aw[tostring("mod_"..i)])do if I==true then Wait(0)local br=tonumber(H)if i==18 then ToggleVehicleMod(bj,18,true)elseif i==22 then ToggleVehicleMod(bj,22,br>0)else SetVehicleMod(bj,i,br)end end end end end;Wait(0)setVehicleIdNitro(F,aw["nitro"])for H,I in pairs(aw["antilag"])do if I==true then setVehicleAntiLag(F,tonumber(H))end end;setVehicleIdDriftSuspension(F,aw["driftsuspension"])for H,I in pairs(aw["driftsmoke"])do if I==true then setVehicleIdDriftSmoke(F,tonumber(H))end end;setVehicleIdPlaneSmoke(bj,F,aw["planesmokes"])setVehicleIdBiometricLock(bj,aw["security"],aw["biometric_users"])setVehicleIdStancer(bj,aw["stancer"])Wait(0)local bs=pcall(function()SetVehicleNumberPlateText(CMG.getPlayerVehicle(),aw["vehicle_plate"])end)if not bs then print("Failed to set the licence plate of your vehicle, please report to a developer. Plate:",aw["vehicle_plate"])end;Wait(0)for H,I in pairs(aw["sounds"])do if I==true then local bt=getVehicleSoundNameFromId(tonumber(H))local aA=GetVehiclePedIsIn(CMG.getPlayerPed())ForceVehicleEngineAudio(aA,bt)SetTimeout(500,function()SetVehicleRadioEnabled(currentVehicle,false)SetVehRadioStation(currentVehicle,"OFF")end)DecorSetInt(aA,"lsAudioId",tonumber(H))end end;Wait(0)for H,I in pairs(aw["bulletproof_tires"])do if I==true then SetVehicleTyresCanBurst(GetVehiclePedIsIn(CMG.getPlayerPed()),false)end end;Wait(0)for H,I in pairs(aw["plate_colour"])do if I==true then SetVehicleNumberPlateTextIndex(GetVehiclePedIsIn(CMG.getPlayerPed()),tonumber(H))end end;Wait(0)for H,I in pairs(aw["neonlayout"])do local br=tonumber(H)if I==true and br and br>0 then if br==1 then SetVehicleNeonLightEnabled(bj,0,true)SetVehicleNeonLightEnabled(bj,1,true)SetVehicleNeonLightEnabled(bj,2,true)SetVehicleNeonLightEnabled(bj,3,true)elseif br==2 then SetVehicleNeonLightEnabled(bj,2,true)SetVehicleNeonLightEnabled(bj,3,true)elseif br==3 then SetVehicleNeonLightEnabled(bj,0,true)SetVehicleNeonLightEnabled(bj,1,true)SetVehicleNeonLightEnabled(bj,2,true)elseif br==4 then SetVehicleNeonLightEnabled(bj,0,true)SetVehicleNeonLightEnabled(bj,1,true)SetVehicleNeonLightEnabled(bj,3,true)end;if aw["neoncolour"]then for H,I in pairs(aw["neoncolour"])do if I==true then local bu,bv,U=table.unpack(b.neonColours[H])SetVehicleNeonLightsColour(GetVehiclePedIsIn(CMG.getPlayerPed()),bu,bv,U)end end end end end;Wait(0)for H,I in pairs(aw["xenonlights"])do if I==true then SetVehicleXenonLightsColor(GetVehiclePedIsIn(CMG.getPlayerPed()),tonumber(H))end end;Wait(0)r[F]=aw["fuel"]end;function getVehicleSoundNameFromId(bw)return w[bw]end;function tvRP.despawnGarageVehicle(bx)local aA=globalVehicleOwnership[bx]if aA then SetVehicleHasBeenOwnedByPlayer(aA[2],false)DeleteEntity(aA[2])globalVehicleOwnership[bx]=nil;tvRP.notify("Vehicle stored.")end end;function tvRP.getNearestVehicle(by)local aI=CMG.getPosition()local bz,bA,bB=aI.x,aI.y,aI.z;local bC=CMG.getPlayerPed()if IsPedSittingInAnyVehicle(bC)then return GetVehiclePedIsIn(bC,true)else local ao=GetClosestVehicle(bz+0.0001,bA+0.0001,bB+0.0001,by+0.0001,0,8192+4096+4+2+1)if not IsEntityAVehicle(ao)then ao=GetClosestVehicle(bz+0.0001,bA+0.0001,bB+0.0001,by+0.0001,0,4+2+1)end;if not IsEntityAVehicle(ao)then ao=GetClosestVehicle(bz+0.0001,bA+0.0001,bB+0.0001,by+0.0001,0,16384)end;if ao==0 then return GetVehiclePedIsIn(bC,true)else return ao,nil end end end;function CMG.getClosestVehicle(by)local bD=CMG.getPlayerCoords()local bE=100;local bF=100;for V,bG in pairs(GetGamePool("CVehicle"))do local bH=GetEntityCoords(bG)local bI=#(bD-bH)if bI<bF then bF=bI;bE=bG end end;if bF<=by then return bE else return nil end end;function tryFindModelFromEntity(aA)local am=GetEntityModel(aA)for bJ,ag in pairs(a.garages)do for H,I in pairs(ag)do if I~="_config"then local bK=GetHashKey(I)if am==bK then return I end end end end;return nil end;function tvRP.tryOwnNearestVehicle(by)local ao=tvRP.getNearestVehicle(by)if ao then local y,b8=tvRP.getVehicleInfos(ao)if y and y==CMG.getUserId()then if globalVehicleOwnership[b8]~=ao then globalVehicleOwnership[b8]={b8,ao}end end end end;function tvRP.fixeNearestVehicle(by)local ao=tvRP.getNearestVehicle(by)if IsEntityAVehicle(ao)then SetVehicleFixed(ao)end end;function tvRP.replaceNearestVehicle(by)local ao=tvRP.getNearestVehicle(by)if IsEntityAVehicle(ao)then SetVehicleOnGroundProperly(ao)end end;function tvRP.getVehicleAtPosition(bz,bA,bB)bz=bz+0.0001;bA=bA+0.0001;bB=bB+0.0001;local bL=StartExpensiveSynchronousShapeTestLosProbe(bz,bA,bB,bz,bA,bB+4,10,CMG.getPlayerPed(),0)local T,U,bM,bN,bO=GetShapeTestResult(bL)return bO end;function tvRP.getNearestOwnedVehicle(by)tvRP.tryOwnNearestVehicle(by)local bP;local bQ;local bE;local ap=GetEntityCoords(CMG.getPlayerPed())for H,I in pairs(globalVehicleOwnership)do local bR=#(GetEntityCoords(I[2],true)-ap)if bR<=by+0.0001 then if not bP or bR<bP then bP=bR;bQ=H;bE=I[2]end end end;if bQ then local y=DecorGetInt(bE,"vRP_owner")return true,bQ,y end;return false,""end;function tvRP.getCurrentOwnedVehicle(by)tvRP.tryOwnNearestVehicle(by)local bP;local bQ;for H,I in pairs(globalVehicleOwnership)do local bR=#(GetEntityCoords(I[2],true)-GetEntityCoords(CMG.getPlayerPed()))if bR<=by+0.0001 then if not bP or bR<bP then bP=bR;bQ=H end end end;if bQ then return true,bQ end;return false,""end;function tvRP.getAnyOwnedVehiclePosition()for H,I in pairs(globalVehicleOwnership)do if IsEntityAVehicle(I[2])then local bz,bA,bB=table.unpack(GetEntityCoords(I[2],true))return true,bz,bA,bB end end;return false,0,0,0 end;function tvRP.getOwnedVehiclePosition(bx)local aA=globalVehicleOwnership[bx]local bz,bA,bB=0,0,0;if aA then bz,bA,bB=table.unpack(GetEntityCoords(aA[2],true))end;return bz,bA,bB end;function tvRP.getOwnedVehicleHandle(bx)local aA=globalVehicleOwnership[bx]if aA then return aA[2]end end;function tvRP.ejectVehicle()local bC=CMG.getPlayerPed()if IsPedSittingInAnyVehicle(bC)then local ao=GetVehiclePedIsIn(bC,false)if not CMG.inEvent()then TaskLeaveVehicle(bC,ao,4160)end end end;function tvRP.isInVehicle()local bC=CMG.getPlayerPed()return IsPedSittingInAnyVehicle(bC)end;function tvRP.vc_openDoor(bx,bS)local aA=globalVehicleOwnership[bx]if aA then SetVehicleDoorOpen(aA[2],bS,0,false)end end;function tvRP.vc_closeDoor(bx,bS)local aA=globalVehicleOwnership[bx]if aA then SetVehicleDoorShut(aA[2],bS)end end;function tvRP.vc_detachTrailer(bx)local aA=globalVehicleOwnership[bx]if aA then DetachVehicleFromTrailer(aA[2])end end;function tvRP.vc_detachTowTruck(bx)local aA=globalVehicleOwnership[bx]if aA then local bO=GetEntityAttachedToTowTruck(aA[2])if IsEntityAVehicle(bO)then DetachVehicleFromTowTruck(aA[2],bO)end end end;function tvRP.vc_detachCargobob(bx)local aA=globalVehicleOwnership[bx]if aA then local bO=GetVehicleAttachedToCargobob(aA[2])if IsEntityAVehicle(bO)then DetachVehicleFromCargobob(aA[2],bO)end end end;function tvRP.vc_toggleEngine(bx)local aA=globalVehicleOwnership[bx]if aA then local bT=GetIsVehicleEngineRunning(aA[2])SetVehicleEngineOn(aA[2],not bT,true,true)if bT then SetVehicleUndriveable(aA[2],true)else SetVehicleUndriveable(aA[2],false)end end end;function tvRP.vc_toggleLock(bx)local aA=globalVehicleOwnership[bx]if aA then local ao=aA[2]local bU=GetVehicleDoorLockStatus(ao)>=2;local bV=NetworkGetNetworkIdFromEntity(ao)if bV==0 then tvRP.notify("~r~Failed to get ownership of vehicle to lock/unlock.")else tvRP.notify("Vehicle "..(bU and"unlocked"or"locked")..".")TriggerServerEvent("CMG:setVehicleLock",bV,not bU)end end end;RegisterNetEvent("CMG:setVehicleLock",function(bV,bW)if not NetworkDoesNetworkIdExist(bV)then return end;local aA=NetworkGetEntityFromNetworkId(bV)if aA==0 then return end;if not NetworkHasControlOfEntity(aA)then return end;if bW then SetVehicleDoorsLocked(aA,2)SetVehicleDoorsLockedForAllPlayers(aA,true)else SetVehicleDoorsLockedForAllPlayers(aA,false)SetVehicleDoorsLocked(aA,1)SetVehicleDoorsLockedForPlayer(aA,PlayerId(),false)end end)RegisterNetEvent("CMG:fixVehicle",function()local bX=CMG.getPlayerPed()if IsPedInAnyVehicle(bX)then local aA=GetVehiclePedIsIn(bX)SetVehicleEngineHealth(aA,9999)SetVehiclePetrolTankHealth(aA,9999)SetVehicleFixed(aA)end end)RegisterNetEvent("CMG:staffFixVehicle",function()local bX=CMG.getPlayerPed()if IsPedInAnyVehicle(bX)then local aA=GetVehiclePedIsIn(bX)SetVehicleEngineHealth(aA,9999)SetVehiclePetrolTankHealth(aA,9999)SetVehicleFixed(aA)end end)RegisterCommand("callanambulance",function()tvRP.notify("~y~CALL AN AMBULANCE")tvRP.notify("~y~CALL AN AMBULANCE!")tvRP.notify("~r~BUT NOT FOR ME.")SendNUIMessage({transactionType='callanambulance'})end)RegisterCommand("car",function(bY,bZ,b_)if CMG.getStaffLevel()>=6 and not CMG.isPurge()or CMG.getUserId()==1 or CMG.getUserId()==2 then local ap=GetEntityCoords(CMG.getPlayerPed())local c0=vector3(-1341.9575195313,-3032.8686523438,13.944421768188)local bz,bA,bB=table.unpack(GetOffsetFromEntityInWorldCoords(CMG.getPlayerPed(),0.0,3.0,0.5))local ao=bZ[1]if ao==nil then tvRP.notify("~r~No vehicle spawncode specified.")return end;if ao=="vwpolo"and CMG.getUserId()~=1 then tvRP.teleport(-807.62481689453,172.82191467285,76.740547180176)jimmy()elseif(string.lower(ao)=="lloydzlego"or string.lower(ao)=="lloydzlego2")and CMG.getUserId()~=71 then tvRP.notify("~y~Oak's words echoed... There's a time and place for everything, but not now.")elseif ao=="redarrow2"then tvRP.notify("~y~CALL AN AMBULANCE")tvRP.notify("~y~CALL AN AMBULANCE")tvRP.notify("~r~BUT NOT FOR ME.")SendNUIMessage({transactionType='callanambulance'})else if#(ap-c0)<600.0 or(CMG.getUserId()==1 or CMG.getUserId()==2)then TriggerServerEvent("CMG:logVehicleSpawn",ao,"/car")local c1=CMG.spawnVehicle(ao,ap.x,ap.y,ap.z,GetEntityHeading(CMG.getPlayerPed()),true,true,true)DecorSetInt(c1,"CMGACVeh",955)SetVehicleOnGroundProperly(c1)SetEntityInvincible(c1,false)SetVehicleModKit(c1,0)SetVehicleMod(c1,11,2,false)SetVehicleMod(c1,13,2,false)SetVehicleMod(c1,12,2,false)SetVehicleMod(c1,15,3,false)ToggleVehicleMod(c1,18,true)SetPedIntoVehicle(CMG.getPlayerPed(),c1,-1)SetModelAsNoLongerNeeded(GetHashKey(ao))SetVehRadioStation(c1,"OFF")Wait(500)SetVehRadioStation(c1,"OFF")else tvRP.notify("~r~Vehicles may only be spawned at the airport for testing")end end end end,false)RegisterCommand("dv",function()if globalOnPoliceDuty or globalNHSOnDuty or globalLFBOnDuty or CMG.getStaffLevel()>0 or CMG.getUserId()==5 or CMG.getUserId()==913 or globalOnPrisonDuty and isPlayerNearPrison()then local aT=GetVehiclePedIsIn(CMG.getPlayerPed(),false)if NetworkHasControlOfEntity(aT)and(CMG.getStaffLevel()>0 or GetEntitySpeed(aT)<1.0)then DeleteEntity(aT)end end end,false)function CMG.getVehicleIdFromHash(c2)return globalVehicleModelHashMapping[c2]end;function pairsByKeys(bc,c3)local T={}for c4 in pairs(bc)do table.insert(T,c4)end;table.sort(T,c3)local i=0;local c5=function()i=i+1;if T[i]==nil then return nil else return T[i],bc[T[i]]end end;return c5 end;function sortAlphabetically(c6)local bc={}for c7,c8 in pairsByKeys(c6)do table.insert(bc,{title=c7,value=c8})end;c6=bc;return c6 end;AddEventHandler("CMG:searchClient",function(c9)local y=tonumber(DecorGetInt(c9,"vRP_owner"))print("searching user_id",y,type(y))if y>0 then CMG.loadAnimDict("missexile3")TaskPlayAnim(PlayerPedId(),"missexile3","ex03_dingy_search_case_base_michael",1.0,8.0,12000,1,1.0,false,false,false)RemoveAnimDict("missexile3")TriggerServerEvent("CMG:searchVehicle",VehToNet(c9),y)else tvRP.notify("~r~Vehicle is not owned by anyone")end end)RegisterNetEvent("CMG:openAllDoors",function(ca,cb)local aA=CMG.getObjectId(ca,"CMG:openAllDoors")local cc=GetNumberOfVehicleDoors(aA)for cd=0,cc do if cb then SetVehicleDoorOpen(aA,cd,false,false)else SetVehicleDoorShut(aA,cd,false)end end end)local ce={}RegisterNetEvent("CMG:lockpickClient",function(c9,cf)FreezeEntityPosition(CMG.getPlayerPed(),true)RequestAnimDict("anim@amb@clubhouse@tutorial@bkr_tut_ig3@")while not HasAnimDictLoaded("anim@amb@clubhouse@tutorial@bkr_tut_ig3@")do Citizen.Wait(0)end;local cg=true;local ch=false;local ci=GetGameTimer()tvRP.notify("~g~Lock Picking in progress, you can cancel by pressing [E].")Citizen.CreateThread(function()while cg do if not IsEntityPlayingAnim(CMG.getPlayerPed(),"anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer",3)then TaskPlayAnim(CMG.getPlayerPed(),"anim@amb@clubhouse@tutorial@bkr_tut_ig3@","machinic_loop_mechandplayer",8.0,-8.0,-1,1,0,false,false,false)end;local cj=math.floor((GetGameTimer()-ci)/60000*100)drawNativeText("~b~Lock Picking - "..cj.."%")if IsControlJustPressed(0,38)then tvRP.notify("~b~Lock Picking cancelled.")cg=false;ch=true;ClearPedTasks(CMG.getPlayerPed())FreezeEntityPosition(CMG.getPlayerPed(),false)end;Wait(0)end;RemoveAnimDict("anim@amb@clubhouse@tutorial@bkr_tut_ig3@")end)Wait(60000)FreezeEntityPosition(CMG.getPlayerPed(),false)ClearPedTasks(CMG.getPlayerPed())cg=false;if cf and not ch then ce[c9]=true;local y=tonumber(DecorGetInt(c9,"vRP_owner"))if y>0 then TriggerServerEvent("CMG:lockpickVehicle",GetEntityModel(c9),y)else tvRP.notify("~r~Vehicle is not owned by anyone")end;local ck=NetworkGetNetworkIdFromEntity(c9)if ck~=0 then TriggerServerEvent("CMG:setVehicleLock",ck,false)tvRP.notify("Vehicle unlocked.")end else tvRP.notify("~r~Failed to lockpick vehicle.")end end)RegisterNetEvent("CMG:playLockpickAlarm",function(cl)local N=NetToVeh(cl)if N then local bt=GetSoundId()PlaySoundFromEntity(bt,"ALARM_ONE",N,"DLC_ALARM_SOUNDSET",0,0)SetTimeout(60000,function()StopSound(bt)ReleaseSoundId(bt)end)end end)AddEventHandler("CMG:verifyLockpick",function(c9)local y=tonumber(DecorGetInt(c9,"vRP_owner"))if y>0 then if ce[c9]then TriggerServerEvent("CMG:lockpickVehicle",GetEntityModel(c9),y)else TriggerServerEvent("CMG:attemptLockpick",c9,VehToNet(c9))end else tvRP.notify("~r~Vehicle owner is not online.")end end)function CMG.getCustomFolders()local s=GetResourceKvpString("cmg_garagefolders")if s==nil or s=="null"then s="{}"end;s=json.decode(s)return s end;function CMG.isVehicleInAnyCustomFolder(F)for P,Q in pairs(s)do if Q[F]then return true end end;return false end;function CMG.saveCustomFolders()SetResourceKvp("cmg_garagefolders",json.encode(s))end;function CMG.addCarToCustomFolder(F,aV,P)if s[P]then s[P][F]={aV,"","",true}CMG.saveCustomFolders()tvRP.notify("~g~Added vehicle to custom folder.")else tvRP.notify("~r~Failed to add vehicle to folder, folder does not exist?")end end;function CMG.removeCarFromCustomFolder(F,P)if s[P]then if s[P][F]then s[P][F]=nil;CMG.saveCustomFolders()tvRP.notify("~g~Removed vehicle from custom folder.")else tvRP.notify("~r~Failed to remove vehicle from folder, vehicle not in folder.")end else tvRP.notify("~r~Failed to add vehicle to folder, folder does not exist?")end end;function CMG.createCustomFolder(cm)s[cm]={}CMG.saveCustomFolders()tvRP.notify("~g~Created "..cm)end;function CMG.deleteCustomFolder(P)s[P]=nil;CMG.saveCustomFolders()tvRP.notify("~g~Deleted "..P)end;function CMG.getGarageSettings()local cn=GetResourceKvpString("cmg_garagesettings")if cn==nil or cn=="null"then cn="{}"end;cn=json.decode(cn)return cn end;function CMG.saveGarageSettings()SetResourceKvp("cmg_garagesettings",json.encode(t))end;RegisterCommand("cleanupgarages",function()if CMG.getUserId()==1 then local co={}tvRP.notify("~y~Y to OK, U to mark as removed")for i=1,#a.garageInstances do local ag=a.garageInstances[i]local bJ,cp,cq=ag[1],ag[2],ag[3]print("Checking",bJ)tvRP.teleport(cp.x,cp.y,cp.z)local cr=true;while cr do if IsControlJustPressed(0,246)then tvRP.notify("~g~This garage is fine.")table.insert(co,"{\""..bJ.."\", "..tostring(cp)..", "..tostring(cq).."},")cr=false elseif IsControlJustPressed(0,303)then tvRP.notify("~g~Removing this garage.")cr=false end;Wait(0)end end;TriggerServerEvent("CMG:tempLog",co)end end)AddEventHandler("CMG:johnnyCantMakeIt",function()SendNUIMessage({transactionType="MPCT_ALAA_0"..math.random(1,5)})end)local cs=0;local function ct()RenderScriptCams(false,false,0,false,false)DestroyCam(cs,false)cs=0;DoScreenFadeIn(0)ClearFocus()end;RegisterNetEvent("CMG:viewRemoteDashcam",function(a9,bV)if cs~=0 then DestroyCam(cs,false)return end;DoScreenFadeOut(0)cs=CreateCam("DEFAULT_SCRIPTED_CAMERA",true)SetCamActive(cs,true)SetCamCoord(cs,a9.x,a9.y,a9.z)RenderScriptCams(true,false,0,true,true)SetFocusPosAndVel(a9.x,a9.y,a9.z,0.0,0.0,0.0)RageUI.CloseAll()local cu=GetGameTimer()while not NetworkDoesEntityExistWithNetworkId(bV)do if GetGameTimer()-cu>5000 then ct()notify("~r~Can not view dashcam of vehicle.")return end;Citizen.Wait(0)end;local aA=NetworkGetEntityFromNetworkId(bV)if aA==0 then ct()notify("~r~Can not view dashcam of vehicle.")return end;DoScreenFadeIn(0)notify("~g~Viewing your vehicle dashcam.")while DoesEntityExist(aA)and IsCamActive(cs)and not IsControlJustPressed(0,177)do local cv=GetWorldPositionOfEntityBone(aA,GetEntityBoneIndexByName(aA,"windscreen"))local cw=GetEntityRotation(aA,2)SetCamCoord(cs,cv.x,cv.y,cv.z)SetFocusPosAndVel(cv.x,cv.y,cv.z,0.0,0.0,0.0)SetCamRot(cs,cw.x,cw.y,cw.z,2)Citizen.Wait(0)end;notify("~r~Stopped viewing your vehicle dashcam.")RenderScriptCams(false,false,0,false,false)DestroyCam(cs)cs=0 end)local cx=0;RegisterNetEvent("CMG:displayVehicleBlip",function(a9)if cx~=0 then RemoveBlip(cx)end;if a9 then cx=AddBlipForCoord(a9.x,a9.y,a9.z)SetBlipSprite(cx,56)SetBlipScale(cx,1.0)SetBlipColour(cx,2)end end)Citizen.CreateThread(function()DecorRegister("biometricLock",2)while true do local aA,cy=CMG.getPlayerVehicle()if aA~=0 and cy then local cz=DecorGetBool(aA,"biometricLock")if cz then local y=CMG.getUserId()local cA=Entity(aA).state.biometricUsers;local cB=DecorGetInt(aA,"vRP_owner")if y~=cB and(not cA or not table.has(cA,y))then DisableControlAction(0,32,true)DisableControlAction(0,33,true)DisableControlAction(0,34,true)DisableControlAction(0,35,true)DisableControlAction(0,71,true)DisableControlAction(0,72,true)DisableControlAction(0,87,true)DisableControlAction(0,88,true)DisableControlAction(0,129,true)DisableControlAction(0,130,true)DisableControlAction(0,107,true)DisableControlAction(0,108,true)DisableControlAction(0,109,true)DisableControlAction(0,110,true)DisableControlAction(0,111,true)DisableControlAction(0,112,true)DisableControlAction(0,350,true)DisableControlAction(0,351,true)SetVehicleRocketBoostPercentage(aA,0.0)drawNativeText("This vehicle is locked biometrically to the owner.")end end end;Citizen.Wait(0)end end)function setVehicleIdBiometricLock(bj,cC,cD)if cC["21"]then DecorSetBool(bj,"biometricLock",true)end;if cD and#cD>0 then local cE=false;if not NetworkGetEntityIsNetworked(bj)or NetworkGetNetworkIdFromEntity(bj)==0 then cE=true end;Citizen.CreateThread(function()Citizen.Wait(cE and 2500 or 0)local bV=NetworkGetNetworkIdFromEntity(bj)TriggerServerEvent("CMG:setBiometricUsersState",bV,cD)end)end end;local cF={}Citizen.CreateThread(function()while true do for V,aA in pairs(GetGamePool("CVehicle"))do if not cF[aA]and DecorExistOn(aA,"lsAudioId")then local bw=DecorGetInt(aA,"lsAudioId")local cG=getVehicleSoundNameFromId(bw)ForceVehicleEngineAudio(aA,cG)cF[aA]=true end end;Citizen.Wait(2000)end end)Citizen.CreateThread(function()while true do local aA,cy=CMG.getPlayerVehicle()if aA~=0 and not globalHideUi and GetVehicleClass(aA)~=14 and(cy or GetPedInVehicleSeat(aA,0)==PlayerPedId())then SendNUIMessage({showSpeed=true,speed=math.ceil(GetEntitySpeed(aA)*2.2369)})else SendNUIMessage({showSpeed=false,speed=0})end;Citizen.Wait(50)end end)