local a=module("cfg/cfg_fuel")Citizen.CreateThread(function()for b,c in pairs(a.stations)do tvRP.addBlip(c.x,c.y,c.z,361,4,"Petrol Station",0.6)end end)local d=false;local e=false;local f=0.0;local g=0.0;local h=1000000;local i=false;function setVehicleFuel(j,k)if type(k)=='number'and k>=0 and k<=100 then SetVehicleFuelLevel(j,k+0.0)DecorSetFloat(j,a.decor,GetVehicleFuelLevel(j))end end;local function l(m,n)local o=10^(n or 0)return math.floor(m*o+0.5)/o end;function CMG.getVehicleFuel(j)return DecorGetFloat(j,a.decor)end;local function p(j)if not DecorExistOn(j,a.decor)then setVehicleFuel(j,math.random(200,800)/10)elseif not i then setVehicleFuel(j,CMG.getVehicleFuel(j))i=true end;if GetIsVehicleEngineRunning(j)then local q=a.fuelUsage[l(GetVehicleCurrentRpm(j),1)]or 1.0;setVehicleFuel(j,GetVehicleFuelLevel(j)-q*(a.classes[GetVehicleClass(j)]or 1.0)/10)end;SendNUIMessage({showFuel=true,fuel=CMG.getVehicleFuel(j)})end;Citizen.CreateThread(function()DecorRegister(a.decor,1)while true do Citizen.Wait(1000)local r=PlayerPedId()if IsPedInAnyVehicle(r)and not CMG.inEvent()then local j=GetVehiclePedIsIn(r)if GetPedInVehicleSeat(j,-1)==r then p(j)end else if i then i=false end end end end)local function s()local t=GetEntityCoords(PlayerPedId())local u={}for b,v in ipairs(GetGamePool("CObject"))do local w=GetEntityModel(v)if a.pumpModels[w]then table.insert(u,v)end end;local x=0;local y=1000;for z,A in pairs(u)do local B=#(t-GetEntityCoords(A))if B<y then y=B;x=A end end;return x,y end;Citizen.CreateThread(function()while true do Citizen.Wait(250)local x,y=s()if y<2.5 then d=x elseif y<10.0 then d=false;Citizen.Wait(500)elseif y<50.0 then d=false;Citizen.Wait(2500)else d=false;Citizen.Wait(5000)end end end)AddEventHandler('fuel:startFuelUpTick',function(x,r,j)f=GetVehicleFuelLevel(j)while e do Citizen.Wait(500)local C=DecorGetFloat(j,a.decor)local D=math.random(10,20)/10.0;local E=D*10;if not x then if GetAmmoInPedWeapon(r,883325847)-D*100>=0 then f=C+D;SetPedAmmo(r,883325847,math.floor(GetAmmoInPedWeapon(r,883325847)-D*100))else e=false end else f=C+D end;if f>100.0 then f=100.0;e=false end;g=g+E;if h>=g then setVehicleFuel(j,f)else e=false end end;if x then TriggerServerEvent('CMG:takeAmount',math.floor(g))end;local F=GetEntityModel(j)local G=CMG.getVehicleIdFromHash(F)if G then local H=CMG.getVehicleFuel(j)TriggerServerEvent("CMG:updateFuel",G,math.floor(H*1000)/1000)end;g=0.0 end)AddEventHandler('fuel:refuelFromPump',function(x,r,j)TaskTurnPedToFaceEntity(r,j,1000)Citizen.Wait(1000)SetCurrentPedWeapon(r,-1569615261,true)CMG.loadAnimDict("timetable@gardener@filling_can")TaskPlayAnim(r,"timetable@gardener@filling_can","gar_ig_5_filling_can",2.0,8.0,-1,50,0,0,0,0)TriggerEvent('fuel:startFuelUpTick',x,r,j)while e do Citizen.Wait(1)for z,A in pairs(a.disabledKeys)do DisableControlAction(0,A)end;local I=GetEntityCoords(j)if x then local J=GetEntityCoords(x)local K=""K="\n"..a.translations.TotalCost..": ~g~Â£"..getMoneyStringFormatted(math.floor(l(g,1)))CMG.DrawText3D(J,a.translations.CancelFuelingPump..K,0.35,4)CMG.DrawText3D(I+vector3(0.0,0.0,0.5),l(f,1).."%",0.35,4)else CMG.DrawText3D(I+vector3(0.0,0.0,0.5),a.translations.CancelFuelingJerryCan.."\nGas can: ~g~"..l(GetAmmoInPedWeapon(r,883325847)/4500*100,1).."% | Vehicle: "..l(f,1).."%",0.35,4)end;if not IsEntityPlayingAnim(r,"timetable@gardener@filling_can","gar_ig_5_filling_can",3)then TaskPlayAnim(r,"timetable@gardener@filling_can","gar_ig_5_filling_can",2.0,8.0,-1,50,0,0,0,0)end;if IsControlJustReleased(0,38)or DoesEntityExist(GetPedInVehicleSeat(j,-1))or d and GetEntityHealth(x)<=0 then e=false end end;ClearPedTasks(r)RemoveAnimDict("timetable@gardener@filling_can")end)Citizen.CreateThread(function()while true do Citizen.Wait(1)local r=PlayerPedId()if not e and(d and GetEntityHealth(d)>0 or GetSelectedPedWeapon(r)==883325847 and not d)then if IsPedInAnyVehicle(r)and GetPedInVehicleSeat(GetVehiclePedIsIn(r),-1)==r then local L=GetEntityCoords(d)CMG.DrawText3D(L+vector3(0.0,0.0,1.2),a.translations.ExitVehicle,0.35,4)else local j=GetPlayersLastVehicle()local I=GetEntityCoords(j)if DoesEntityExist(j)and#(GetEntityCoords(r)-I)<2.5 then if not DoesEntityExist(GetPedInVehicleSeat(j,-1))then local J=GetEntityCoords(d)local M=true;if GetSelectedPedWeapon(r)==883325847 then J=I;if GetAmmoInPedWeapon(r,883325847)<100 then M=false end end;if GetVehicleFuelLevel(j)<95 and M then if h>0 then CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.EToRefuel,0.35,4)if IsControlJustReleased(0,38)then e=true;TriggerEvent('fuel:refuelFromPump',d,r,j)end else CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.NotEnoughCash,0.35,4)end elseif not M then CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.JerryCanEmpty,0.35,4)else CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.FullTank,0.35,4)end end elseif d then local J=GetEntityCoords(d)if h>=a.jerryCanCost then if not HasPedGotWeapon(r,883325847)then CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.PurchaseJerryCan,0.35,4)if IsControlJustReleased(0,38)then GiveWeaponToPed(r,883325847,4500,false,true)TriggerServerEvent('CMG:takeAmount',a.jerryCanCost)h=50000 end else local N=l(a.fuelCost*(1-GetAmmoInPedWeapon(r,883325847)/4500))if N>0 then CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.RefillJerryCan..N,0.35,4)if IsControlJustReleased(0,38)then TriggerServerEvent('CMG:takeAmount',math.floor(N))SetPedAmmo(r,883325847,4500)end else CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.JerryCanFull,0.35,4)end end else CMG.DrawText3D(J+vector3(0.0,0.0,1.2),a.translations.NotEnoughCash,0.35,4)end else Citizen.Wait(250)end end else Citizen.Wait(250)end end end)Citizen.CreateThread(function()RequestStreamedTextureDict("regplates")while not HasStreamedTextureDictLoaded("regplates")do Citizen.Wait(1)end;AddReplaceTexture("vehshare","plate01","regplates","plate01")AddReplaceTexture("vehshare","plate01_n","regplates","plate01_n")AddReplaceTexture("vehshare","plate02","regplates","plate02")AddReplaceTexture("vehshare","plate02_n","regplates","plate02_n")AddReplaceTexture("vehshare","plate03","regplates","plate03")AddReplaceTexture("vehshare","plate03_n","regplates","plate03_n")AddReplaceTexture("vehshare","plate04","regplates","plate04")AddReplaceTexture("vehshare","plate04_n","regplates","plate04_n")AddReplaceTexture("vehshare","plate05","regplates","plate05")AddReplaceTexture("vehshare","plate05_n","regplates","plate05_n")end)