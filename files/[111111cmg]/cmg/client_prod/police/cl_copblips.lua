local a=false;local b={}local c={}local function d()for e,f in pairs(b)do if DoesBlipExist(f)then RemoveBlip(f)end end;b={}end;local function g()for e,f in pairs(c)do if DoesBlipExist(f)then RemoveBlip(f)end end;c={}end;local function h(i,j,k)if not DoesBlipExist(i)then local l=AddBlipForEntity(j)table.insert(b,l)SetBlipSprite(l,1)SetBlipScale(i,0.85)SetBlipAlpha(i,255)SetBlipColour(i,k)ShowHeadingIndicatorOnBlip(i,true)else if GetEntityHealth(j)>102 then SetBlipSprite(i,1)else SetBlipSprite(i,274)end;SetBlipScale(i,0.85)SetBlipAlpha(i,255)SetBlipColour(i,k)ShowHeadingIndicatorOnBlip(i,true)end end;local function m(n,o)return IsEntityVisible(n)or not CMG.clientGetPlayerIsStaff(o)end;local function p(q,r,k)local l=AddBlipForCoord(q.x,q.y,q.z)table.insert(c,l)if r==0 then SetBlipSprite(l,1)else SetBlipSprite(l,274)end;SetBlipScale(l,0.85)SetBlipAlpha(l,255)SetBlipColour(l,k)end;RegisterCommand("blipson",function()if globalOnPoliceDuty or globalNHSOnDuty or globalLFBOnDuty or globalOnPrisonDuty then a=true end end,false)RegisterCommand("blipsoff",function()a=false;d()end,false)RegisterNetEvent("CMG:disableFactionBlips",function()a=false;d()g()end)Citizen.CreateThread(function()while true do if a or tvRP.isInComa()then local n=CMG.getPlayerPed()for e,f in ipairs(GetActivePlayers())do local j=GetPlayerPed(f)if j~=n then local i=GetBlipFromEntity(j)local s=GetPlayerServerId(f)if s~=-1 then local t=CMG.clientGetUserIdFromSource(s)local u,v=CMG.getJobType(t)if u~=""and t~=CMG.getUserId()then if m(j,s)then if a then if u=="metpd"and(v=="CID Constable"or v=="CID Sergeant")then h(i,j,27)elseif u=="metpd"and v=="NPAS"then h(i,j,5)elseif u=="metpd"then h(i,j,3)elseif u=="hmp"then h(i,j,29)elseif u=="lfb"then h(i,j,1)elseif u=="nhs"and v=="HEMS"then h(i,j,44)elseif u=="nhs"then h(i,j,2)end elseif tvRP.isInComa()then if u=="nhs"then h(i,j,2)end end else local w=GetBlipFromEntity(j)if w~=0 then RemoveBlip(w)end end end end end end end;Wait(100)end end)local x=true;local y=GetPlayerServerId(PlayerId())CreateThread(function()Wait(20000)x=false end)RegisterNetEvent("CMG:sendFarBlips",function(z)if not x then a=true;g()for e,A in pairs(z)do if A.source~=y and GetPlayerFromServerId(A.source)==-1 and A.bucket==CMG.getPlayerBucket()then p(A.position,A.dead,A.colour)end end end end)RegisterNetEvent("CMG:Revive",function()if not a then Citizen.Wait(1000)d()end end)