local a=module("cfg/events/cfg_triathlon")local b={}local c={}local d={location=1,amount=2}local e=""local f={isParachuting=false,isOnBMX=false,isRunning=false,isInRace=false,closetCheckpoint=nil,hasFinished=false,currentCheckpoint=0,currentCheckpointId=0,checkpointDistance=0.0}local g=nil;local h={}local i={}local j={}local k={}Citizen.CreateThread(function()for l,m in pairs(a.triathlon.races)do b[#b+1]=l end;for n=1,100 do c[n]=tostring(n)end end)RegisterNetEvent("CMG:joinExtremeTriathlon",function(o)e=o;f.isInRace=true end)RegisterNetEvent("CMG:buildAirCheckpoints",function()for n=1,#a.triathlon.races[e].checkpoints do local p=a.triathlon.races[e].checkpoints[n]j[n]=CreateCheckpoint(13,p.x,p.y,p.z,a.triathlon.races[e].cycle,50.0,255,255,0,127,0)end;if e=="Vinewood Sign"then local q=0;CMG.loadModel(`prop_mp_arrow_barrier_01`)for n=1,12 do local r=CreateObject(`prop_mp_arrow_barrier_01`,847.02429199219+q,1290.3720703125-q,359.15859985352,false,true,true)SetEntityHeading(r,308.50)FreezeEntityPosition(r,true)PlaceObjectOnGroundProperly(r)k[#k+1]=r;q=q+2 end;SetModelAsNoLongerNeeded(`prop_mp_arrow_barrier_01`)end end)RegisterNetEvent("CMG:addParachuteToCheckpoint",function(s)g=s;CMG.stopEventSequence(false)f.isParachuting=true;local t=AddBlipForCoord(s)SetBlipSprite(t,226)h["bmx"]=CreateCheckpoint(0,s.x,s.y,s.z-1.0,a.triathlon.races[e].run,10.0,255,255,0,127,0)SetCheckpointCylinderHeight(h["bmx"],40.0,70.0,25.0)i["bmx"]=t;local u=function()CMG.loadModel(`bmx`)CMG.spawnVehicle(`bmx`,s.x,s.y,s.z,10.0,true,true,true)SetModelAsNoLongerNeeded(`bmx`)f.isParachuting=false;f.isOnBMX=true;DeleteCheckpoint(h["bmx"])RemoveBlip(i["bmx"])tvRP.removeArea("cmg_triathlon_race_bmx")PlaySoundFrontend(-1,"RACE_PLACED","HUD_AWARDS")createBmxToCheckpoint(a.triathlon.races[e].run)nextCheckpoint()end;local v=function()end;local w=function()end;CMG.createArea("cmg_triathlon_race_bmx",s,6.0,6,u,v,w)end)function createBmxToCheckpoint(s)local t=AddBlipForCoord(s)SetBlipSprite(t,226)SetBlipRoute(t,true)h["bmxTo"]=CreateCheckpoint(0,s.x,s.y,s.z-1.0,a.triathlon.races[e].finish,10.0,255,255,0,127,0)SetCheckpointCylinderHeight(h["bmxTo"],40.0,140.0,25.0)i["bmxTo"]=t;local u=function()if GetEntityModel(CMG.getPlayerVehicle())==`bmx`then DeleteEntity(CMG.getPlayerVehicle())f.isOnBMX=false;f.isRunning=true;DeleteCheckpoint(h["bmxTo"])RemoveBlip(i["bmxTo"])tvRP.removeArea("cmg_triathlon_race_bmxTo")PlaySoundFrontend(-1,"RACE_PLACED","HUD_AWARDS")createFinishCheckPoint(a.triathlon.races[e].finish)end end;local v=function()end;local w=function()end;CMG.createArea("cmg_triathlon_race_bmxTo",s,6.0,6,u,v,w)end;function createFinishCheckPoint(s)local t=AddBlipForCoord(s)SetBlipSprite(t,38)h["finish"]=CreateCheckpoint(9,s.x,s.y,s.z-1.0,0,0,0,10.0,255,255,0,127,0)i["finish"]=t end;RegisterNetEvent("CMG:eventTimer",function(x)CMG.showCountdownTimer(x)end)local y={["bmx"]=function()local z=true;local A=Scaleform("MIDSIZED_MESSAGE")A.RunFunction("SHOW_SHARD_MIDSIZED_MESSAGE",{"~y~TRIATHLON","RIDE TO THE CHECKPOINT!",5,true,false})local B=Citizen.CreateThread(function()while true do if z then A.Render2D()end;Wait(0)end end)Wait(5000)z=false;TerminateThread(B)end,["runto"]=function()local z=true;local A=Scaleform("MIDSIZED_MESSAGE")A.RunFunction("SHOW_SHARD_MIDSIZED_MESSAGE",{"~y~TRIATHLON","RUN TO THE FINISH!",5,true,false})local B=Citizen.CreateThread(function()while true do if z then A.Render2D()end;Wait(0)end end)Wait(5000)z=false;TerminateThread(B)end,["finish"]=function(C)local z=true;local A=Scaleform("MIDSIZED_MESSAGE")A.RunFunction("SHOW_SHARD_MIDSIZED_MESSAGE",{"~y~TRIATHLON",C,5,true,false})Citizen.CreateThread(function()while true do if z then A.Render2D()end;Wait(0)end end)Wait(5000)z=false end,["para"]=function()local z=true;local A=Scaleform("MIDSIZED_MESSAGE")A.RunFunction("SHOW_SHARD_MIDSIZED_MESSAGE",{"~y~TRIATHLON","PARACHUTE THROUGH THE CHECKPOINTS TO THE BMX!",5,true,false})local B=Citizen.CreateThread(function()while true do if z then A.Render2D()end;Wait(0)end end)Wait(5000)z=false;TerminateThread(B)end}RegisterNetEvent("CMG:eventScaleform",function(D,E)if y[D]~=nil then y[D](table.unpack(E or{}))end end)RegisterNetEvent("CMG:dnfTimer",function()local z=true;local A=Scaleform("MIDSIZED_MESSAGE")A.RunFunction("SHOW_SHARD_MIDSIZED_MESSAGE",{"~y~TRIATHLON","EVENT IS ENDING IN 30 SECONDS",5,true,false})Citizen.CreateThread(function()while z do A.Render2D()Wait(0)end end)Wait(5000)CMG.showCountdownTimer(31)z=false;if not f.hasFinished then TriggerServerEvent("CMG:didNotFinish",currentEvent.eventId)end end)local F=false;Citizen.CreateThread(function()while true do if f.isParachuting and e~=nil then local G=GetEntityCoords(PlayerPedId())for n=1,#a.triathlon.races[e].checkpoints do local p=a.triathlon.races[e].checkpoints[n]if#(G-p)<=25.0 then if not F then PlaySoundFrontend(-1,"RACE_PLACED","HUD_AWARDS")F=true;SetTimeout(500,function()F=false end)end;DeleteCheckpoint(j[n])j[n]=nil end end end;Citizen.Wait(150)end end)function func_drawHelpText()if f.isParachuting then RageUI.Text({message="Press LMB or F to deploy parachute"})end end;CMG.createThreadOnTick(func_drawHelpText)function func_drawDirectionMarker()if f.isParachuting then local H=g;local I=CMG.getPlayerCoords()local J=H-I;J=J/#J;DrawMarker(2,I.x,I.y,I.z+1.0,J.x,J.y,J.z,90.0,0,0,1.0,1.0,1.0,0,0,255,150,false,false,2,false,nil,nil,false)end end;CMG.createThreadOnTick(func_drawDirectionMarker)function func_parachuting()if f.isInRace then if IsPedInParachuteFreeFall(CMG.getPlayerPed())and not HasEntityCollidedWithAnything(CMG.getPlayerPed())then ApplyForceToEntity(CMG.getPlayerPed(),true,0.0,75.0,2.5,0.0,0.0,0.0,false,true,false,false,false,true)end;DisableControlAction(2,37,true)DisablePlayerFiring(PlayerPedId(),true)DisableControlAction(0,106,true)DisableControlAction(0,45,true)DisableControlAction(0,24,true)DisableControlAction(0,263,true)DisableControlAction(0,140,true)DisableControlAction(0,75,true)DisableControlAction(27,75,true)CMG.setWeapon(PlayerPedId(),`WEAPON_UNARMED`,true)local K=CMG.getPlayerPed()SetEntityInvincible(K,true)SetPlayerInvincible(PlayerId(),true)SetPedCanRagdoll(K,false)ClearPedBloodDamage(K)ResetPedVisibleDamage(K)ClearPedLastWeaponDamage(K)SetEntityProofs(K,true,true,true,true,true,true,true,true)SetEntityCanBeDamaged(K,false)end end;CMG.createThreadOnTick(func_parachuting)RegisterCommand("heading",function()print(GetEntityHeading(PlayerPedId()))end)RegisterNetEvent("CMG:finishRace",function()DeleteCheckpoint(h["finish"])RemoveBlip(i["finish"])PlaySoundFrontend(-1,"ScreenFlash","WastedSounds")f.isRunning=false;f.isInRace=false;showingDNFscaleform=false;f.hasFinished=true end)local function L()currentEvent.isActive=false;for l,m in pairs(h)do DeleteCheckpoint(m)end;h={}for l,m in pairs(i)do RemoveBlip(m)end;i={}for l,m in pairs(j)do DeleteCheckpoint(m)end;showingDNFscaleform=false;f.isInRace=false end;AddEventHandler("CMG:eventCleanup",L)function nextCheckpoint()if f.currentCheckpointId~=0 then DeleteCheckpoint(f.currentCheckpointId)tvRP.removeArea("cmg_triathlon_race_"..f.currentCheckpointId)end;if f.currentCheckpoint~=1 then f.currentCheckpoint=f.currentCheckpoint+1 end;if f.currentCheckpoint>#a.triathlon.races[e].extraCheckpoints then return end;local s=a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint]f.currentCheckpointId=CreateCheckpoint(0,s.x,s.y,s.z-1.0,a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint+1],10.0,255,255,0,127,0)if f.currentCheckpoint==1 then f.currentCheckpoint=2 end;f.checkpointDistance=#(CMG.getPlayerCoords()-a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint+1])local u=function()if GetEntityModel(CMG.getPlayerVehicle())==`bmx`then nextCheckpoint()PlaySoundFrontend(-1,"RACE_PLACED","HUD_AWARDS")end end;local v=function()end;local w=function()end;CMG.createArea("cmg_triathlon_race_"..f.currentCheckpointId,s,6.0,6,u,v,w)end;Citizen.CreateThread(function()while true do if f.isInRace then if e and f.currentCheckpoint~=nil then if a.triathlon.races[e].extraCheckpoints and a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint]then if#(CMG.getPlayerCoords()-a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint])>=f.checkpointDistance then SetEntityCoords(PlayerPedId(),a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint])if GetEntityModel(CMG.getPlayerVehicle())~=`bmx`then CMG.spawnVehicle(`bmx`,a.triathlon.races[e].extraCheckpoints[f.currentCheckpoint],10.0,true,true,true)end end end end end;Wait(2000)end end)