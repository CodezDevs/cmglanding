local a=nil;local b={}local c;local d;local e={}local f=0;local g={}local h={}local i={}local j=module("cfg/homes")RMenu.Add("cmghouses","mainmenu",RageUI.CreateMenu("","",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_homesui","cmg_homesui"))RMenu:Get("cmghouses","mainmenu"):SetSubtitle("~b~HOME")RMenu.Add('cmghouses','exit',RageUI.CreateMenu("","",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_homesui","cmg_homesui"))RMenu:Get("cmghouses","exit"):SetSubtitle("~b~HOME")RMenu.Add('cmghouses','rentmanager',RageUI.CreateSubMenu(RMenu:Get('cmghouses','mainmenu'),"","~b~Rent Management Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('cmghouses','rentedout',RageUI.CreateSubMenu(RMenu:Get('cmghouses','rentmanager'),"","~b~Houses Rented Out",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('cmghouses','rentedin',RageUI.CreateSubMenu(RMenu:Get('cmghouses','rentmanager'),"","~b~Houses Renting",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('cmghouses','rentedinfo',RageUI.CreateSubMenu(RMenu:Get('cmghouses','rentmanager'),"","~b~Houses Rent Info",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RageUI.CreateWhile(1.0,RMenu:Get("cmghouses","mainmenu"),nil,function()RageUI.IsVisible(RMenu:Get("cmghouses","mainmenu"),true,false,true,function()if a~=nil and j.homes~=nil then for k,l in pairs(j.homes)do if a==k then RMenu:Get("cmghouses","mainmenu"):SetSubtitle("~b~"..k)RMenu:Get("cmghouses","exit"):SetSubtitle("~b~"..k)if l.ownerString then if l.ownerString=="For sale."then RageUI.ButtonWithStyle("Purchase House","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:buyHome",k)end end)RageUI.ButtonWithStyle("Preview House","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:previewHome",k)end end)end else if clientOwnsHome(k)then RageUI.ButtonWithStyle("Enter House","Enter this home",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o and not CMG.inEvent()then TriggerServerEvent("CMG:enterHome",k)end end)RageUI.ButtonWithStyle("Sell House to Player","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:sellHomeToPlayer",k)end end)RageUI.ButtonWithStyle("Rent House to Player","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:rentHomeToPlayer",k)end end)else RageUI.ButtonWithStyle("Ring Bell","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then if GetGameTimer()-f>5000 and not CMG.inEvent()then f=GetGameTimer()TriggerServerEvent("CMG:enterHome",k)end end end)if globalOnPoliceDuty then RageUI.ButtonWithStyle("Raid House","~b~MET Police Raid",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:raidHome",k)end end)end;if not globalOnPoliceDuty then RageUI.ButtonWithStyle("House Robbery","~r~Break into this house",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o and not CMG.inEvent()then TriggerServerEvent("CMG:houseRobbery",k)end end)end end end;RageUI.ButtonWithStyle("Rent Manager","~y~Manage your rented out & renting houses here.",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then selectedHouse=k end end,RMenu:Get('cmghouses','rentmanager'))end end end end,function()end)RageUI.IsVisible(RMenu:Get("cmghouses","exit"),true,false,true,function()RageUI.ButtonWithStyle("Exit Home","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then if d then tvRP.teleport(d.x,d.y,d.z)TriggerEvent("CMG:removeFromHome")CMG.leaveActiveHouse()end end end)end,function()end)RageUI.IsVisible(RMenu:Get('cmghouses','rentmanager'),true,true,true,function()RageUI.ButtonWithStyle("Houses Rented Out",selectedHouse,{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then end end,RMenu:Get('cmghouses','rentedout'))RageUI.ButtonWithStyle("Houses Rented In",selectedHouse,{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then end end,RMenu:Get('cmghouses','rentedin'))end,function()end)RageUI.IsVisible(RMenu:Get('cmghouses','rentedout'),true,true,true,function()for p,q in pairs(g)do local k,r,s=q.homeName,q.rentedBy,q.hoursLeft;RageUI.ButtonWithStyle(k,"Rented to "..r.." - "..s.." hours left!",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then i=q;i.type="rentingout"end end,RMenu:Get('cmghouses','rentedinfo'))end end,function()end)RageUI.IsVisible(RMenu:Get('cmghouses','rentedin'),true,true,true,function()for p,q in pairs(h)do local k,r,s=q.homeName,q.rentedBy,q.hoursLeft;RageUI.ButtonWithStyle(k,"Rented from "..r.." - "..s.." hours left!",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then i=q;i.type="rentingin"end end,RMenu:Get('cmghouses','rentedinfo'))end end,function()end)RageUI.IsVisible(RMenu:Get('cmghouses','rentedinfo'),true,true,true,function()local k,r,s=i.homeName,i.rentedBy,i.hoursLeft;RageUI.Separator("~y~Rent Info")RageUI.Separator("---------")RageUI.Separator("House: "..k)RageUI.Separator("Rented from: "..r)RageUI.Separator("Hours Left: "..s)RageUI.ButtonWithStyle("Request Home Rent Cancellation","",{RightLabel="→→→"},true,function(m,n,o)if m then end;if n then end;if o then TriggerServerEvent("CMG:requestHomeRentCancellation",k,i.type)end end)end,function()end)end)local function t(u)a=u;RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmghouses','mainmenu'),true)end;local function v(u)RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmghouses','mainmenu'),false)end;local function w()RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmghouses','exit'),true)end;local function x()RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmghouses','exit'),false)end;Citizen.CreateThread(function()local y=function(z)PlaySound(-1,"Hit","RESPAWN_SOUNDSET",0,0,1)t(z.houseName)end;local A=function(z)PlaySound(-1,"Hit","RESPAWN_SOUNDSET",0,0,1)v(z.houseName)end;local B=function(z)end;for k,l in pairs(j.homes)do l.position=vector3(l.entry_point[1],l.entry_point[2],l.entry_point[3])CMG.createArea("house_"..k,l.position,1.5,6,y,A,B,{houseName=k})tvRP.addMarker(l.position.x,l.position.y,l.position.z-1,0.7,0.7,0.5,0,255,125,125,50,20,false,false,true)end end)RegisterNetEvent("CMG:houseBought",function(k)if e["home_"..k]then tvRP.removeBlip(e["home_"..k])e["home_"..k]=nil end;j.homes[k].ownerString=nil end)RegisterNetEvent("CMG:updateHomeData",function(C,D)j.homes[C]=D end)RegisterNetEvent("CMG:sendOwnedHomes",function(E)b=E end)RegisterNetEvent("CMG:addHome",function(F)b[F]=true;j.homes[F].ownerString=nil end)RegisterNetEvent("CMG:removeHome",function(k)b[k]=nil;if e["home_"..k]then tvRP.removeBlip(e["home_"..k])e["home_"..k]=nil end end)function clientOwnsHome(C)if b[C]then return true else return false end end;RegisterNetEvent("CMG:createHouseExit",function(G,H)c=G;d=H end)RegisterNetEvent("CMG:forceBoltCutting",function()TaskStartScenarioInPlace(CMG.getPlayerPed(),"WORLD_HUMAN_WELDING",0,true)local I=true;SetTimeout(300000,function()I=false end)local J=GetGameTimer()tvRP.notify("~g~House Robbery in progress, you can cancel by pressing [E].")while I and GetEntityHealth(CMG.getPlayerPed())>102 do if not IsPedUsingScenario(CMG.getPlayerPed(),"WORLD_HUMAN_WELDING")then TaskStartScenarioInPlace(CMG.getPlayerPed(),"WORLD_HUMAN_WELDING",0,true)end;local K=math.floor((GetGameTimer()-J)/300000*100)drawNativeText("~b~House Robbery - "..K.."%")if IsControlJustPressed(0,38)then tvRP.notify("~b~House Robbery cancelled.")I=false;ClearPedTasks(CMG.getPlayerPed())end;Wait(0)end end)Citizen.CreateThread(function()local L=false;while true do if c then local M=CMG.getPlayerPed()local N=GetEntityCoords(CMG.getPlayerPed())if#(N-c)<1.5 then w()L=false elseif not L then L=true;x()end end;Wait(250)end end)RegisterNetEvent("CMG:initRentingHouses",function(O)g=O end)RegisterNetEvent("CMG:initRentedHouses",function(P)h=P end)RegisterNetEvent("CMG:insertRentedHouse",function(Q)table.insert(h,Q)end)RegisterNetEvent("CMG:insertRentingHouse",function(R)table.insert(g,R)end)RegisterNetEvent("CMG:decreaseHourRentedHouses",function(C)for S,T in pairs(h)do if string.lower(T.homeName)==string.lower(C)then if h[S].hoursLeft>1 then h[S].hoursLeft=h[S].hoursLeft-1 else h[S]=nil end end end end)RegisterNetEvent("CMG:decreaseHourRentingHouses",function(C)for S,T in pairs(g)do if string.lower(T.homeName)==string.lower(C)then if g[S].hoursLeft>1 then g[S].hoursLeft=g[S].hoursLeft-1 else g[S]=nil end end end end)RegisterNetEvent("CMG:endRentedHouse",function(C)for S,T in pairs(h)do if string.lower(T.homeName)==string.lower(C)then h[S]=nil end end end)RegisterNetEvent("CMG:endRentingHouse",function(C)for S,T in pairs(g)do if string.lower(T.homeName)==string.lower(C)then g[S]=nil end end end)RegisterNetEvent("CMG:someoneAtTheDoor",function()local U=GetSoundId()PlaySoundFrontend(U,"DOOR_Intercom_MASTER",0,false)ReleaseSoundId(U)end)RegisterNetEvent("CMG:setupHomesForSale",function(V)for F,p in pairs(V)do j.homes[F].ownerString="For sale."end;for k,l in pairs(j.homes)do if l.ownerString=="For sale."then e["home_"..k]=tvRP.addBlip(l.entry_point[1],l.entry_point[2],l.entry_point[3],l.blipId,l.blipColour,k)end end end)RegisterNetEvent("CMG:sendHomeBlips",function(W)for p,T in pairs(W)do local C=T[1]local X=T[2]tvRP.addBlip(X.x,X.y,X.z,374,1,C)end end)RegisterNetEvent("CMG:houseGettingRobbed",function(k,Y)local U=GetSoundId()PlaySoundFrontend(U,"End_Zone_Flash","DLC_BTL_RB_Remix_Sounds",true)ReleaseSoundId(U)if Y then CMG.announceMpBigMsg("~b~WARNING","~b~Your house "..k.." is being RAIDED by the MET Police!",5000)else CMG.announceMpBigMsg("~r~WARNING","Your house "..k.." is being BROKEN INTO!",5000)end end)function CMG.leaveActiveHouse()if a then c=nil;d=nil;TriggerServerEvent("CMG:exitHome",a)a=nil end end