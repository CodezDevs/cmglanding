local a={active=false,spawnedDecks=false,coords=vector3(0,0,0),handles={},dui=nil,isStatic=false,currentStaticId=nil}local b={volume=1,volumeWhole=10}local c={}local d=0;local e=vector3(0.0,0.0,0.0)local f=0;local g=false;local h=false;local i={}local j={{"Big Cone","prop_roadcone01a"}}local k={{coords=vector3(1551.7019042969,249.96797180176,-48.203105926514),heading=256.84},{coords=vector3(375.33557128906,275.97552490234,92.399833679199),heading=256.84},{coords=vector3(4893.5034179688,-4905.390625,3.4866433143616),heading=178.2}}RMenu.Add('cmgmusic','main',RageUI.CreateMenu("Sound System","~b~DJ Mixer",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))RMenu.Add('cmgmusic','admin',RageUI.CreateSubMenu(RMenu:Get("cmgmusic","main"),"DJ Admin","~b~DJ Admin Menu",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))TriggerEvent('chat:addSuggestion','/play','Play a song on the DJ Mixer',{{name="URL",help="Video ID"}})TriggerEvent('chat:addSuggestion','/djmenu','Toggle the DJ Mixer')TriggerEvent('chat:addSuggestion','/djadmin','Administrate the use of the DJ Mixer')local function l(m,n)local o={type=m,payload=n}if a.duiObj then SendDuiMessage(a.duiObj,json.encode(o))end end;RageUI.CreateWhile(1.0,RMenu:Get('cmgmusic','main'),nil,function()RageUI.IsVisible(RMenu:Get('cmgmusic','main'),true,false,true,function()if inOrganHeist then return elseif not a.active then if h then RageUI.Button("Start Session","Start a new DJ Session",{},function(p,q,r)if r then if CMG.getPlayerCombatTimer()==0 and not CMG.isPlayerInRedZone()and CMG.getPlayerVehicle()==0 then setupDj()else notify("~r~You can not set up a DJ deck right now.")end end end)end else RageUI.SliderProgress("Song Volume",b.volumeWhole,10,"Select or update the song volume",{ProgressBackgroundColor={R=0,G=0,B=0,A=255},ProgressColor={R=0,G=117,B=194,A=255}},true,function(p,r,q,s)if r then if s~=b.volumeWhole then b.volumeWhole=s;b.volume=s/10;updateVolume()drawNativeText("~b~DJ~w~: Volume Updated")end end end)RageUI.Button("Stop Song","Stop the current song",{},function(p,q,r)if r then stopDjSong()drawNativeText("~b~DJ~w~: Song Stopped")end end)RageUI.Button("End Session","Stop the current DJ Session",{},function(p,q,r)if r then stopDj()drawNativeText("~b~DJ~w~: Session Ended")end end)RageUI.Button("Help","Assistance message",{},function(p,q,r)if r then TriggerEvent("CMG:showNotification",{text="The Video ID is the ID at the end of the YouTube URL after =",height="200px",width="auto",colour="#FFF",background="#32CD32",pos="bottom-right",icon="success"},5000)end end)end end,function()end)RageUI.IsVisible(RMenu:Get('cmgmusic','admin'),true,false,true,function()if table.count(i)>0 then for t,u in pairs(i)do if i[t]~=nil then RageUI.Button("ID: "..u[3].." - Started: "..u[5],"Name: "..u[4].." Distance Away: "..round2(#(CMG.getPlayerCoords()-u[2]),2).." metres",{},function(p,q,r)if r then TriggerServerEvent("CMG:adminStopSong",u[1])i[t]=nil end end)end end end end,function()end)end)function round2(v,w)return math.floor(v*10^w+0.5)/10^w end;RegisterNetEvent("CMG:playDjSong",function(x,coords,y,z)local A=CMG.getPlayerCoords()local B=#(coords-A)local C=false;for D,E in pairs(c)do if#(E[1]-coords)>2.5 and#(A-E[1])<B then C=true;break end end;if C then return end;l("play",{payload="https://youtube.com/watch?v="..x})Wait(300)if B<30.0 then drawNativeText("~b~DJ "..z.."~w~: New Song playing")l("volume",{payload=1})else l("volume",{payload=0})end;for t,u in pairs(c)do c[t]=nil end;c[y]={coords,x,true,1}end)RegisterNetEvent("CMG:requestCurrentProgress",function(x,coords)if not g then if specificSongPlaying(coords)then d=x;e=coords;SendNUIMessage({type='requestProgress'})end end end)RegisterNetEvent("CMG:toggleDjMenu",function()RageUI.Visible(RMenu:Get('cmgmusic','main'),not RageUI.Visible(RMenu:Get('cmgmusic','main')))h=not h end)RegisterNetEvent("CMG:toggleDjAdminMenu",function(F)RageUI.Visible(RMenu:Get('cmgmusic','admin'),true)i=F end)RegisterNetEvent("CMG:finaliseSong",function(G)if a.active then TriggerServerEvent("CMG:playDjSongServer",G,a.coords)end end)RegisterNetEvent("CMG:updateDjVolume",function(coords,H)if specificSongPlaying(coords)then b.volume=H;l("volume",{payload=H})end end)RegisterNetEvent("CMG:stopSong",function(coords)local I=false;for t,u in pairs(c)do if u[1]==coords then I=true;c[t]=nil end end;if I then l("stop",{})end end)RegisterNetEvent("CMG:skipDj",function(coords,J)if specificSongPlaying(coords)then if J then SendNUIMessage({type='djSkipAhead'})else SendNUIMessage({type='djSkipBack'})end end end)function skipDj(J)if songPlaying()then TriggerServerEvent("CMG:skipServer",a.coords,J)end end;function setupDj(K)a.active=true;a.coords=CMG.getPlayerCoords()a.spawnedDecks=true;if not K then createDjObject(0.0,1.5,0.0,`ba_prop_battle_dj_stand`,0.0)createDjObject(-1.5,1.5,0.0,`ba_prop_battle_club_speaker_large`,180.0)createDjObject(1.5,1.5,0.0,`ba_prop_battle_club_speaker_large`,180.0)createDjObject(0.0,-1.2,0.0,`prop_studio_light_01`,180.0)end end;function createDjDui()a.duiObj=CreateDui("https://arthur-fivem-hypnonema.pages.dev/",1280,720)a.dui=GetDuiHandle(a.duiObj)local L=CreateRuntimeTxd('djmenu')CreateRuntimeTextureFromDuiHandle(L,"user",a.dui)l("init",{payload={resourceName=GetCurrentResourceName(),posterUrl="https://cdn.discordapp.com/attachments/856971689891856394/1002189147160727632/unknown.png"}})local M=`des_tvsmash_start`local N=vector3(-810.59,170.46,77.25)local O=GetClosestObjectOfType(N.x,N.y,N.z,0.05,M,0,0,0)local P=CreateNamedRenderTargetForModel("tvscreen",M)Citizen.CreateThread(function()while true do SetTextRenderId(P)SetScriptGfxDrawOrder(4)SetScriptGfxDrawBehindPausemenu(1)DrawSprite("djmenu","user",0.5,0.5,1.0,1.0,0.0,255,255,255,255)SetTextRenderId(GetDefaultScriptRendertargetRenderId())SetScriptGfxDrawBehindPausemenu(0)Citizen.Wait(0)end end)end;Citizen.CreateThread(function()createDjDui()end)function createDjObject(Q,R,S,T,U)local T=CMG.loadModel(T)coords=GetOffsetFromEntityInWorldCoords(CMG.getPlayerPed(),Q,R,S)local V=CreateObject(T,coords.x,coords.y,coords.z,true,true,true)SetModelAsNoLongerNeeded(T)table.insert(a.handles,V)PlaceObjectOnGroundProperly(V)FreezeEntityPosition(V,true)local W=GetEntityHeading(CMG.getPlayerPed())SetEntityHeading(V,W+U)end;function stopDj()if songPlaying()then TriggerServerEvent("CMG:stopSongServer",a.coords)end;a.active=false;a.spawnedDecks=false;for D,P in pairs(a.handles)do if NetworkGetEntityIsNetworked(P)then local X=NetworkGetNetworkIdFromEntity(P)if X>0 then TriggerServerEvent("CMG:djDeleteObject",X)end else DeleteObject(P)end end;if a.isStatic then a.isStatic=false;TriggerServerEvent("CMG:setStaticDjMenuNotInUse",a.currentStaticId)FreezeEntityPosition(CMG.getPlayerPed(),false)CMG.cancelEmote(true)tvRP.setCanAnim(true)TriggerEvent("CMG:toggleDjMenu",false)end;a.handles={}end;function stopDjSong()if songPlaying()then TriggerServerEvent("CMG:stopSongServer",a.coords)end end;function updateVolume()if songPlaying()then TriggerServerEvent("CMG:updateVolumeServer",a.coords,b.volume)end end;function specificSongPlaying(coords)local I=false;for t,u in pairs(c)do if u[1]==coords and u[3]then I=true end end;return I end;function songPlaying()local I=false;for t,u in pairs(c)do if u[1]==a.coords then I=true end end;return I end;function func_checkDjSongs(Y)for t,u in pairs(c)do if#(Y.playerCoords-u[1])>45.0 then l("volume",{payload=0.0})elseif#(Y.playerCoords-u[1])>15.0 then l("volume",{payload=0.1})elseif#(Y.playerCoords-u[1])>35.0 then l("volume",{payload=0.01})else l("volume",{payload=b.volume})end end end;CMG.createThreadOnTick(func_checkDjSongs)RegisterNUICallback('returnProgress',function(Z,_)if Z.progress~=nil then if Z.progress~=0 then TriggerServerEvent("CMG:returnProgressServer",d,e,Z.progress)end end;_('return')end)RegisterNetEvent("CMG:returnProgress",function(x,coords,a0,a1)if g then if specificSongPlaying(coords)then c[x]=nil;c[x]={coords,x,true}l("play",{payload=a1})Wait(1000)l("seek",{payload=a0})g=false end end end)local function a2()local a3={"se_h4_dlc_int_02_h4_lobby","se_h4_dlc_int_02_h4_main_bar","se_h4_dlc_int_02_h4_main_front_02","se_h4_dlc_int_02_h4_main_front_01","se_h4_dlc_int_02_h4_bogs","se_h4_dlc_int_02_h4_entrance_doorway","se_h4_dlc_int_02_h4_main_room_cutscenes"}for t,u in pairs(a3)do SetStaticEmitterEnabled(u,false)end end;AddEventHandler("CMG:onClientSpawn",function(a4,a5)if a5 then for a6,a7 in pairs(k)do local function a8()if not GlobalState["djmenuinuse_"..a6]then drawNativeNotification("Press ~INPUT_CONTEXT~ to open the DJ Menu!")else drawNativeNotification("This DJ Station is in use.")end end;local function a9()end;local function aa()if not GlobalState["djmenuinuse_"..a6]then drawNativeNotification("Press ~INPUT_CONTEXT~ to open the DJ Menu!")elseif not a.isStatic then drawNativeNotification("This DJ Station is in use.")end;if IsControlJustPressed(1,51)and not GlobalState["djmenuinuse_"..a6]then setupDj(true)local ab=CMG.getPlayerPed()TriggerEvent("CMG:toggleDjMenu")TriggerServerEvent("CMG:setStaticDjMenuInUse",a6)SetEntityCoords(ab,a7.coords)SetEntityHeading(ab,a7.heading)Wait(500)FreezeEntityPosition(ab,true)CMG.playEmote("dj")tvRP.setCanAnim(false)a.isStatic=true;a.currentStaticId=a6 end end;CMG.createArea("dj"..a6,a7.coords,2.5,6.0,a8,a9,aa)end;a2()end end)