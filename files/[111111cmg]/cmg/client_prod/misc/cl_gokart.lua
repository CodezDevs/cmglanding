local a=false;local b=false;local c=nil;local d={-1016.9984741211,-3493.4174804688,14.143417358398,58.0}local e=false;local f=vector3(-1025.3901367188,-3474.9365234375,14.229237937927)local g=false;local h=false;local i=1;local j=0;local k=false;local l={{-1058.34765625,-3473.3583984375,12.327661514282},{-1035.6046142578,-3499.1516113281,12.330018043518},{-1074.3129882813,-3446.5241699219,12.332399368286},{-1118.0103759766,-3510.3559570313,12.150929450989},{-1077.2532958984,-3523.8186035156,12.316527366638},{-1059.4982910156,-3534.212890625,18.846857070923},{-1026.7734375,-3489.9467773438,12.344030380249}}AddEventHandler("CMG:onClientSpawn",function(m,n)if n then CMG.createDynamicPed(`a_m_y_motox_02`,vector3(-1026.2969970703,-3476.4011230469,13.329237937927),0.0,true,nil,nil,75.0,nil,function(o)FreezeEntityPosition(o,true)SetEntityInvincible(o,true)SetBlockingOfNonTemporaryEvents(o,true)end)tvRP.addMarker(f.x,f.y,f.z,0.7,0.7,0.5,0,125,255,125,50,20,false,false,true)end end)AddEventHandler("CMG:onClientSpawn",function(m,n)if n then local p=function(q)if not a then drawNativeNotification("Press ~INPUT_PICKUP~ to pay Â£5,000 and compete in a race")else drawNativeNotification("~r~Race in progress, come back later!")end end;local r=function(q)end;local s=function(q)if IsControlJustPressed(0,38)then if not g then TriggerServerEvent("CMG:requestJoinGoKartGame")else tvRP.notify("~r~Please wait up to 60 seconds for us to refuel your kart.")end end end;CMG.createArea("gokart",f,1.5,6,p,r,s,{})end end)local t=55;local u=30;local v=false;Citizen.CreateThread(function()while true do if a and v then u=u-1;if u<1 then v=false end end;if goKartRaceEndingSoon then endingSoonSeconds=endingSoonSeconds-1 end;Wait(1000)end end)Citizen.CreateThread(function()while true do if b then local w=CMG.getPlayerPed()drawNativeNotification("Press ~INPUT_CELLPHONE_LEFT~ or ~INPUT_CELLPHONE_RIGHT~ to change colour!")if IsControlJustPressed(0,174)then t=t-1;if t<29 then t=140 end;SetVehicleColours(GetVehiclePedIsIn(w),t)end;if IsControlJustPressed(0,175)then t=t+1;if t>140 then t=29 end;SetVehicleColours(GetVehiclePedIsIn(w),t)end end;if e then if GetVehicleEngineHealth(c)<=150 then local w=CMG.getPlayerPed()DoScreenFadeOut(2000)NetworkFadeOutEntity(w,true,false)Wait(2000)SetEntityCoords(c,d[1],d[2],d[3],0.0,0.0,d[4],false)SetEntityHeading(c,d[4])SetEntityHeading(w,d[4])SetVehicleEngineHealth(c,1000.0)NetworkFadeInEntity(w,0)DoScreenFadeIn(2000)end;DisableControlAction(0,75)DisableControlAction(0,49)end;if a then if u>0 then DrawAdvancedText(0.6,0.88,0.005,0.0028,0.64,"Race starting in "..u.."  seconds!",36,146,36,255,7,0)end end;if h then DrawGTATimerBar("LAP:",i.."/3",1)DrawGTATimerBar("TIME:",getFormattedSecondsTime(j),2)end;if goKartRaceEndingSoon and h then DrawGTATimerBar("ENDING IN:",endingSoonSeconds,3)elseif goKartRaceEndingSoon then DrawGTATimerBar("ENDING IN:",endingSoonSeconds,1)end;if setDisableActionsEndRace then DisableAllControlActions(0)EnableControlAction(0,0)EnableControlAction(0,1)EnableControlAction(0,2)EnableControlAction(0,3)EnableControlAction(0,4)EnableControlAction(0,5)EnableControlAction(0,6)EnableControlAction(0,7)EnableControlAction(0,245)EnableControlAction(0,246)EnableControlAction(0,249)end;Wait(0)end end)RegisterNetEvent("CMG:joinGoKartGame",function(x)u=x;a=true;v=true;local y=CMG.loadModel(`gokart`)c=CreateVehicle(y,-1002.2916870117,-3488.869140625,14.22924041748,0.0,true,false)DecorSetInt(c,"CMGACVeh",955)TaskWarpPedIntoVehicle(CMG.getPlayerPed(),c,-1)FreezeEntityPosition(c,true)FreezeEntityPosition(CMG.getPlayerPed(),true)b=true;TriggerServerEvent("CMG:requestGoKartPosition")SetModelAsNoLongerNeeded(y)end)RegisterNetEvent("CMG:gokartSpawnAtRacetrack",function(z)SetEntityCoords(c,z[1],z[2],z[3],0.0,0.0,z[4],false)SetEntityHeading(c,z[4])SetEntityHeading(CMG.getPlayerPed(),z[4])end)RegisterNetEvent("CMG:actuallyStartRaceNow",function()disableSlashDV=true;b=false;PlaySoundFrontend(-1,"5s","MP_MISSION_COUNTDOWN_SOUNDSET",0)Citizen.CreateThread(function()local A=5;for B=1,A do local C=true;SetTimeout(1000,function()C=false end)local D=RequestScaleformMovie("mp_big_message_freemode")while not HasScaleformMovieLoaded(D)do Citizen.Wait(0)end;BeginScaleformMovieMethod(D,"SHOW_SHARD_WASTED_MP_MESSAGE")if 5-B==0 then ScaleformMovieMethodAddParamTextureNameString("~g~GO!")else ScaleformMovieMethodAddParamTextureNameString("~g~"..tostring(5-B))end;EndScaleformMovieMethod()while C do Citizen.Wait(0)DrawScaleformMovieFullscreen(D,255,255,255,255,0)end end;e=true;startGoKartRacePositionManager()end)end)function startGoKartRacePositionManager()h=true;j=0;startCountingLapTime()FreezeEntityPosition(c,false)FreezeEntityPosition(CMG.getPlayerPed(),false)for B=1,3,1 do i=B;for E,F in pairs(l)do if l[E+1]~=nil then local G=CreateCheckpoint(1,F[1],F[2],F[3],l[E+1][1],l[E+1][2],l[E+1][3],5.0,36,146,36,255,0)local H=#(GetEntityCoords(CMG.getPlayerPed())-vector3(F[1],F[2],F[3]))while H>5 do H=#(GetEntityCoords(CMG.getPlayerPed())-vector3(F[1],F[2],F[3]))Wait(100)if k then k=false;DeleteCheckpoint(G)return end end;DeleteCheckpoint(G)else local G=CreateCheckpoint(1,F[1],F[2],F[3],l[1][1],l[1][2],l[1][3],5.0,36,146,36,255,0)local H=#(GetEntityCoords(CMG.getPlayerPed())-vector3(F[1],F[2],F[3]))while H>5 do H=#(GetEntityCoords(CMG.getPlayerPed())-vector3(F[1],F[2],F[3]))Wait(100)if k then k=false;DeleteCheckpoint(G)return end end;DeleteCheckpoint(G)end;d={F[1],F[2],F[3],GetEntityHeading(CMG.getPlayerPed())}SetVehicleEngineHealth(c,GetVehicleEngineHealth(c)+150.0)end;if B~=3 then Citizen.CreateThread(function()local C=true;SetTimeout(1000,function()C=false end)local D=RequestScaleformMovie("mp_big_message_freemode")while not HasScaleformMovieLoaded(D)do Citizen.Wait(0)end;BeginScaleformMovieMethod(D,"SHOW_SHARD_WASTED_MP_MESSAGE")ScaleformMovieMethodAddParamTextureNameString("~g~LAP "..tostring(B+1).."/3 ")EndScaleformMovieMethod()while C do Citizen.Wait(0)DrawScaleformMovieFullscreen(D,255,255,255,255,0)end end)end end;h=false;TriggerServerEvent("CMG:goKartRaceFinished")end;function startCountingLapTime()Citizen.CreateThread(function()while h do j=j+1;Wait(1000)end end)end;RegisterNetEvent("CMG:celebrateYouWonGoKart",function()setDisableActionsEndRace=true;SetVehicleBrake(c,true)Wait(5000)TaskLeaveVehicle(CMG.getPlayerPed(),c,0)Wait(500)RequestAnimDict("anim@arena@celeb@flat@solo@no_props@")while not HasAnimDictLoaded("anim@arena@celeb@flat@solo@no_props@")do RequestAnimDict("anim@arena@celeb@flat@solo@no_props@")Wait(0)end;TaskPlayAnim(CMG.getPlayerPed(),"anim@arena@celeb@flat@solo@no_props@","flip_a_player_a",8.0,8.0,-1,1,1.0)RemoveAnimDict("anim@arena@celeb@flat@solo@no_props@")SetVehicleBrake(c,false)end)RegisterNetEvent("CMG:celebrateYouLostGoKart",function()setDisableActionsEndRace=true;SetVehicleBrake(c,true)Wait(5000)TaskLeaveVehicle(CMG.getPlayerPed(),c,0)Wait(500)RequestAnimDict("anim@arena@celeb@podium@no_prop@")while not HasAnimDictLoaded("anim@arena@celeb@podium@no_prop@")do RequestAnimDict("anim@arena@celeb@podium@no_prop@")Wait(0)end;TaskPlayAnim(CMG.getPlayerPed(),"anim@arena@celeb@podium@no_prop@","flip_off_a_1st",8.0,8.0,-1,1,1.0)RemoveAnimDict("anim@arena@celeb@podium@no_prop@")SetVehicleBrake(c,false)end)RegisterNetEvent("CMG:goKartRaceEnd",function()k=true;SetTimeout(1000,function()k=false end)goKartRaceEndingSoon=false;endingSoonSeconds=0;e=false;a=false;setDisableActionsEndRace=false;DeleteEntity(c)SetEntityCoords(CMG.getPlayerPed(),-1024.3458251953,-3472.9282226563,14.329239845276,0.0,0.0,0.0,true)FreezeEntityPosition(CMG.getPlayerPed(),false)disableSlashDV=false;ClearPedSecondaryTask(CMG.getPlayerPed())i=1;j=0;h=false end)RegisterNetEvent("CMG:goKartRaceEndingSoon",function()goKartRaceEndingSoon=true;endingSoonSeconds=30 end)function getFormattedSecondsTime(A)local A=tonumber(A)if A<=0 then return"00:00:00"else hours=string.format("%02.f",math.floor(A/3600))mins=string.format("%02.f",math.floor(A/60-hours*60))secs=string.format("%02.f",math.floor(A-hours*3600-mins*60))return hours..":"..mins..":"..secs end end;Citizen.CreateThread(function()tvRP.addBlip(-1026.2969970703,-3476.4011230469,13.329237937927,127,3,"Go Karting")tvRP.addBlip(-1680.2836914063,-913.97357177734,8.0451745986938,136,47,"Beach Cinema")end)