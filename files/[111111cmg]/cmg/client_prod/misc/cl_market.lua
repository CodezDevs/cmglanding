RMenu.Add('cmgmarket','main',RageUI.CreateMenu("","Items",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight(),"cmg_marketui","cmg_marketui"))RMenu.Add('cmgmarket','amount',RageUI.CreateSubMenu(RMenu:Get('cmgmarket','main'),""," ",CMG.getRageUIMenuWidth(),CMG.getRageUIMenuHeight()))local a={menuOpen=false,currentMenu=0,markets={},marketsTypes={},distanceToMarket=0,currentMarket={},amountIndex=1,selectedItem={},itemNames={},currentMarketId=""}local b={}local c={}local d={}local e;local f={}for g=1,100 do table.insert(f,tostring(g))end;local function h(i)local j={}for k,l in pairs(i)do if k~="_config"then table.insert(j,{itemId=k,price=l})end end;table.sort(j,function(m,n)return m.price<n.price end)local g=0;return function()g=g+1;if j[g]then return j[g].itemId,j[g].price else return nil,nil end end end;RageUI.CreateWhile(1.0,RMenu:Get('cmgmarket','main'),nil,function()RageUI.IsVisible(RMenu:Get('cmgmarket','main'),true,false,true,function()for o,l in h(a.currentMarket)do RageUI.ButtonWithStyle(a.itemNames[a.currentMarketId][o][1],a.itemNames[a.currentMarketId][o][3],{RightLabel="£"..getMoneyStringFormatted(l)},true,function(p,q,r)if r then RMenu:Get("cmgmarket","amount").MetaData={item_id=o,price=l}end end,RMenu:Get('cmgmarket','amount'))end end,function()end)RageUI.IsVisible(RMenu:Get('cmgmarket','amount'),true,false,true,function(s)RageUI.List("Amount",f,a.amountIndex,"Current Price: £"..getMoneyStringFormatted(s.price*a.amountIndex),{},true,function(p,q,r,t)if q then a.amountIndex=t end end,function()end,nil)RageUI.Button("Buy","Current Price: £"..getMoneyStringFormatted(s.price*a.amountIndex),{},function(p,q,r)if r then TriggerServerEvent("CMG:requestToBuyItem",s.item_id,a.amountIndex)end end)end,function()end)end)RegisterNetEvent("CMG:buildMarketMenus",function(u)for g=1,#d do tvRP.removeArea(d[g])d[g]=nil end;for g=1,#c do tvRP.removeMarker(c[g])end;local v=function(s)a.currentMarket=b[s.market_id]a.currentMarketId=s.market_id;a.menuOpen=true;RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmgmarket','main'),true)end;local w=function()a.menuOpen=false;RageUI.CloseAll()RageUI.Visible(RMenu:Get('cmgmarket','main'),false)end;local x=function()end;for g=1,#u do local y=u[g]local z="market"..u[g][1]..g;CMG.createArea(z,y[2],1.25,6,v,w,x,{market_id=u[g][1]})local A=tvRP.addMarker(y[2].x,y[2].y,y[2].z,0.7,0.7,0.5,0,255,125,125,50,29,true,true)d[#d+1]=z;c[#c+1]=A end end)RegisterNetEvent("CMG:buildMarkets",function(B,C)b=B;a.itemNames=C end)RegisterNetEvent("CMG:playItemBoughtSound",function()SendNUIMessage({transactionType="playMoney"})end)function GetMarketRefund(D)TriggerServerEvent("CMG:getRefundFromMarket",D)end